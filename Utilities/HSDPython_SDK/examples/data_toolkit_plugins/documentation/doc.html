<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Unlock the potential of STMicroelectronics sensors with DataToolkit, a powerful Python-based framework.">
    <meta name="keywords" content="ML Platform, DataToolkit, STMicroelectronics, Python, Sensors">
    <title>DataToolkit</title>
    <!-- Include Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <!-- Include Prism.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism.min.css" />
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <div class="logo">
            <img src="Img/ST_logo_2024_blue.svg" alt="Logo" >
            <div>
                <div class="title">ST DataToolkit</div>
                <div class="version">0.0.1</div>
            </div>
        </div>
        <nav>
            <a href="#download-and-configure" aria-label="Download" class="nav-button">Download</a>
            <a href="#tutorials-section" aria-label="Tutorials" class="nav-button">Tutorials</a>
            <!-- <a href="#" aria-label="API" class="nav-button">API</a>
            <a href="#" aria-label="Ecosystem" class="nav-button">Ecosystem</a> -->
        </nav>
        <div>
            <div class="logo">
                <a href="https://github.com/STMicroelectronics/fp-sns-datalog2/tree/main/Utilities/HSDPython_SDK" style="margin-right: 12px;" aria-label="GitHub">GitHub</a>
                <img src="Img/github_logo.png" alt="GitHub">
            </div>
        </div>
    </header>

    <main class="container">
        <section class="header-section">
            <h2>Unlock the Power of STMicroelectronics Sensors with DataToolkit<br><span style="font-size: 12pt;">A powerful Python framework with plugin-based data processing pipeline.</span></h2>
            <img src="Img/logo.png" alt="DataToolkit Framework" class="rounded-logo-big">
        </section>

        <section class="main-content" id="hello-world-plugin">
            <div class="content-container">
                <div class="text-content">
                    <h2>Hello World Plugin</h2>
                    <p>Start by creating a basic plugin and then <br> explore our comprehensive list of tutorials.</p>
                    <a href="#tutorials-section" class="button-blue">View tutorials</a>
                </div>
                <div class="code-sample">
                    <div class="code-container">
                        <button class="copy-btn" onclick="copyCode('code-block-1')">
                            <img src="Icon/copy_paste_icon.png" alt="Copy">
                        </button>
                        <button class="download-btn" onclick="downloadPythonFile('code-block-1', 'HelloWorldPlugin.py')">
                            <img src="Icon/download_icon.png" alt="Download">
                        </button>
                        <pre><code class="language-python" id="code-block-1">
from st_hsdatalog.HSD_datatoolkit.HSD_DataToolkit_Pipeline import HSD_Plugin

class PluginClass(HSD_Plugin):

    def __init__(self):
        super().__init__()
        print("HelloWorldPlugin has been initialized!")
    
    def process(self, data):
        print("HelloWorldPlugin process method called")
        print(f"---> Received data from: {data.comp_name}")
        print(f"-----> Data: {data.data}")
        print(f"-----> Timestamp: {data.timestamp}")
        return data

    def create_plot_widget(self):
        print("HelloWorldPlugin create_plot_widget method called")
                        </code></pre>
                    </div>
                </div>
            </div>
        </section>

        <section class="intro section">
            <h2 class="section-title">What is it?</h2>
            <p>DataToolkit is a Python framework designed to simplify the development of applications using data from <b>STMicroelectronics sensors</b>.
                It provides complete <b>hardware abstraction</b>, making it easier to handle real-time data from connected ST system solutions or stored datasets.</p>
                <p>DataToolkit features a <b>flexible plugin architecture</b>, allowing easy extension of its functionalities. Its modular <b>data processing pipeline</b>
                    lets you add plugins to customize and enhance data processing to meet specific requirements.</p>
            <p>Whether you are:</p>
            <ul>
                <li>Creating an <b>AI solution</b></li>
                <li>Developing or testing <b>algorithms</b></li>
                <li>Plotting data for <b>monitoring</b></li>
            </ul>
            <p>you can now fully utilize Python with <b>real-world data</b>.</p>
            <p>DataToolkit is built on top of <b>ST High-Speed Datalog Python SDK</b>
                (<a href="https://github.com/STMicroelectronics/fp-sns-datalog2/tree/main/Utilities/HSDPython_SDK" class="link-in-text">HSD_PythonSDK</a>)
                and is designed to work with all STMicroelectronics platforms that support the <b>FP-SNS-DATALOG2</b> function pack.<br>
            </p>
            <p>View the list of supported platforms <a href="#supported-platforms" class="link-in-text">here</a>.</p>
        </section>

        <section class="intro section">
            <h2 class="section-title">How to use it?</h2>
            <ol>
                <li>
                    <strong>Download and Configure the DataToolkit</strong>:
                    <p>Follow <a href="#download-and-configure" class="link-in-text">these</a> instructions to download the
                        framework and set up your environment.</p>
                </li>
                <br>
                <li>
                    <strong>Create Your First Plugin</strong>: 
                    <p>After setting up DataToolkit, you are ready to create your first plugin.
                        Plugins allow you to extend the functionality of the framework to suit your specific needs.</p>
                    <div class="example-card">
                        <h3>What is a Plugin?</h3>
                        <p>A plugin is a modular component that allow to perform specific tasks, such as data processing,
                            visualization or saving files extending the framework capabilities without modifying its core functionality.
                            Please go <a href="#what-is-a-plugin" class="link-in-text">here</a> for a more detailed explanation.</p>
                    </div>
                    <br>
                    <div class="example-card">
                        <h3>How to configure the Plugins Pipeline</h3>
                        <p>To properly configure the data processing pipeline, you need to select the plugin files that will compose it.
                            Once selected, live sensor data can flow through this pipeline allowing you to perform data processing and other tasks.
                            For a detailed step-by-step guide, refer to the dedicated section
                            <a href="#how_to_configure_pipeline" class="link-in-text">here</a>.</p>
                    </div>
                    <br>
                    <div class="example-card">
                        <h3>Hello World Plugin</h3>
                        <p>To get familiar with the framework, begin with the
                            <a href="#helloworld_plugin_tutorial" class="link-in-text">Hello World Plugin</a>.
                            This simple example will help you understand the basics and get started quickly.</p>
                    </div>
                </li>
            </ol>
        </section>

        <section id="download-and-configure" class="download section">
            <h2 class="section-title">Download and Configure</h2>
            <p>To get started with DataToolkit, follow these steps:</p>
            <ol>
                <li>
                    <strong>Get the High-Speed Datalog Python SDK</strong>:
                    <ul>
                        <br>
                        <li>Download the <b>FP-SNS-DATALOG2</b> function pack <a href="https://www.st.com/en/embedded-software/fp-sns-datalog2.html" class="link-in-text">here</a> from st.com or <a href="https://github.com/STMicroelectronics/fp-sns-datalog2" class="link-in-text">here</a> from GitHub.</p>
                        <ul>
                            <li>Once downloaded, you will find the <span class="code-inline">HSDPython_SDK</span> folder in the <span class="code-inline">Utilities</span> directory of the <span class="code-inline">FP-SNS-DATALOG2</span> function pack.</p>
                            <li>Navigate to the <span class="code-inline">Utilities/HSDPython_SDK</span> directory to access the SDK files.</p>
                            <li>The <span class="code-inline">HSDPython_SDK</span> directory contains all the necessary files and folders to get started with the DataToolkit framework.</p>
                        </ul>
                        <li>Ensure you have <span class="code-inline">Python3</span> in you system (supported versions >= 3.10 and <= 3.12). If Python is not installed, download and install it from <a href="https://www.python.org/downloads/" class="link-in-text">here</a>.</p>
                        <li>Ensure that Python is added to your system's PATH environment variable. This allows you to run Python from any command prompt or terminal window. To add Python to your PATH:</p>
                        <div class="example-card" style="padding-top: 25px;">
                            <ul>
                                <li><span style="font-weight: bold;">On Windows:</span>
                                    <ol>
                                        <br>
                                        <li>Open the Start menu and search for "Environment Variables".</li>
                                        <li>Select "Edit the system environment variables".</li>
                                        <li>In the System Properties window, click on the "Environment Variables" button.</li>
                                        <li>In the Environment Variables window, find the "Path" variable in the "System variables" section and select it.</li>
                                        <li>Click "Edit" and then "New" to add a new entry.</li>
                                        <li>Enter the path to your Python installation directory (e.g., <code>C:\Python39</code>).</li>
                                        <li>Click "OK" to close all windows.</li>
                                    </ol>
                                </li>
                                <li><strong>On macOS and Linux:</strong>
                                    <ol>
                                        <li>Open a terminal window.</li>
                                        <li>Open your shell profile file in a text editor (e.g., <code>nano ~/.bash_profile</code> or <code>nano ~/.zshrc</code>).</li>
                                        <li>Add the following line to the file, replacing <code>/path/to/python</code> with the path to your Python installation directory:
                                            <pre><code>export PATH="/path/to/python:$PATH"</code></pre>
                                        </li>
                                        <li>Save the file and close the text editor.</li>
                                        <li>Run <code>source ~/.bash_profile</code> or <code>source ~/.zshrc</code> to apply the changes.</li>
                                    </ol>
                                </li>
                            </ul>
                        </div>
                    </ul>
                </li>
                <li>
                    <strong>Create a Python Virtual Environment</strong>:
                    <p>It is <span style="color:deepskyblue; font-weight: bold;">recommended*</span> to use a clean virtual environment for configuration. Navigate to the <span class="code-inline">HSDPython_SDK</span> root directory, open a terminal, and run:</p>
                    <div class="code-container">
                        <button class="copy-btn" onclick="copyCode('code-block-2')">
                            <img src="Icon/copy_paste_icon.png" alt="Copy">
                        </button>
                        <pre><code class="language-bash" id="code-block-2">python -m venv .venv</code></pre>
                    </div>
                    <p>This command will create a new directory named <span class="code-inline">.venv</span> in your project root. This directory will contain a clean Python environment with its own installation of Python and pip.</p>
                    <p><span style="color:deepskyblue; font-weight: bold;">* </span><span style="font-style: italic; font-size: small;">Using a virtual</div> environment is highly recommended because it allows you to create an isolated environment for your project. This isolation ensures that the dependencies and packages required for your project do not interfere with those of other projects or the system-wide Python installation. It helps in maintaining a clean and manageable development environment, avoiding potential conflicts between different package versions, and making it easier to reproduce and share your project setup with others.</span></p>
                </li>
                <li>
                    <strong>Activate the Virtual Environment</strong>:
                    <p>On Windows:</p>
                    <div class="code-container">
                        <button class="copy-btn" onclick="copyCode('code-block-3')">
                            <img src="Icon/copy_paste_icon.png" alt="Copy">
                        </button>
                        <pre><code class="language-bash" id="code-block-3">.venv\Scripts\activate</code></pre>
                    </div>
                    <p>On macOS and Linux:</p>
                    <div class="code-container">
                        <button class="copy-btn" onclick="copyCode('code-block-4')">
                            <img src="Icon/copy_paste_icon.png" alt="Copy">
                        </button>
                        <pre><code class="language-bash" id="code-block-4">source .venv/bin/activate</code></pre>
                    </div>
                </li>
                <li>
                    <strong>Install the HSD Python SDK</strong>:
                    <p>Run the following command from the downloaded HSDPython_SDK root directory to install the SDK packages:</p>
                    <p>On Windows:</p>
                    <div class="code-container">
                        <button class="copy-btn" onclick="copyCode('code-block-5')">
                            <img src="Icon/copy_paste_icon.png" alt="Copy">
                        </button>
                        <pre><code class="language-bash" id="code-block-5">.\HSDPython_SDK_install.bat</code></pre>
                    </div>
                    <p>On macOS and Linux (once ensured the script has execution permission):</p>
                    <div class="code-container">
                        <button class="copy-btn" onclick="copyCode('code-block-6')">
                            <img src="Icon/copy_paste_icon.png" alt="Copy">
                        </button>
                        <pre><code class="language-bash" id="code-block-6">./HSDPython_SDK_install.sh</code></pre>
                    </div>
                    <!-- HSDPython_SDK_install.bat -->
                    <p>Your <span class="code-inline">.venv</span> virtual environment is now configured.</p>
                </li>
                <li>
                    <strong>Configure Your Platform with FP-SNS-DATALOG2 Firmware</strong>:
                    <p>- Select one of the <a href="#supported-platforms" class="link-in-text">Supported Platforms</a><span style="color: lightskyblue; font-family: Consolas; font-weight: bold;">*</span></p>
                    <p>- Select the corresponding firmware binary from the <span class="code-inline">Projects\<span style="color: lightskyblue;">*&lt;Selected_Board_Name&gt;</span>\Applications\DATALOG2\Binary</span> directory.</p>
                    <p>- Use <a href="https://www.st.com/en/development-tools/stm32cubeprog.html" class="link-in-text">STM32CubeProgrammer</a> to flash the board with the selected FP-SNS-DATALOG2 firmware binary.</p>
                    <div class="example-card">
                        <p>If you are not familiar with the firmware flashing process, you can follow those video instructions.</p>
                        <div class="video-container">
                            <video controls>
                                <source src="Video/flashing_board.mp4" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        </div>
                    </div>
                </li>
                <li>
                    <strong>Test the High-Speed Datalog application</strong>:
                    <p>Ensure the <span class="code-inline">.venv</span> virtual environment is activated, then run the
                        <span class="code-inline">hsdatalog_GUI.py</span> script located in the
                        <span class="code-inline">HSDPython_SDK/examples</span> directory.</p>
                        <ul>
                        <li>Open a terminal window on your computer</li>
                        <li>Navigate to the directory: <span class="code-inline">HSDPython_SDK/examples</span></li>
                        <li>Run the <span class="code-inline">hsdatalog_GUI.py</span> script by executing the following command in the terminal:</li>
                        <p>On Windows</p>
                        <div class="code-container">
                            <button class="copy-btn" onclick="copyCode('code-block-10')">
                                <img src="Icon/copy_paste_icon.png" alt="Copy">
                            </button>
                            <pre><code class="language-bash" id="code-block-10">python hsdatalog_GUI.py</code></pre>
                        </div>
                        <p>On macOS and Linux</p>
                        <div class="code-container">
                            <button class="copy-btn" onclick="copyCode('code-block-11')">
                                <img src="Icon/copy_paste_icon.png" alt="Copy">
                            </button>
                            <pre><code class="language-bash" id="code-block-11">python3 hsdatalog_GUI.py</code></pre>
                        </div>
                        <br>
                        </ul>
                        <div class="example-card">
                            <p>Follow this video tutorial for detailed step-by-step instructions.</p>
                            <div class="video-container">
                                <video controls>
                                    <source src="Video/HSDatalog_test.mp4" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                            </div>
                        </div>
                </li>
            </ol>
        </section>

        <section id="what-is-a-plugin" class="tutorials-section">
            <div class="foldable open">
                <header class="header" onclick="toggleFold(this)">
                    <h1>What is a Plugin?</h1>
                    <span class="arrow">&#9654;</span>
                </header>
                <div class="intro">
                    <p>A plugin is a modular component that can be added to the DataToolkit framework to perform specific tasks, such as data processing, visualization, or saving data to files. Plugins allow you to customize and extend the framework's capabilities without modifying its core functionality.</p>
                    <p>Plugins are designed to be reusable and can be easily connected to form a data processing pipeline. This modular approach enables you to customize and enhance data processing to meet specific requirements.</p>
                    <p>Each plugin is implemented as a Python class named <span class="code-inline">PluginClass</span> that inherits from the <span class="code-inline">HSD_Plugin</span> base class. The plugin class must implement at least the following three methods:</p>
                    <ul>
                        <li><span class="code-inline">__init__(self)</span>: This constructor method is responsible for initializing the plugin's class. It sets up the initial state of the plugin and prepares any necessary resources or configurations. This method is called when an instance of the plugin is created, ensuring that the plugin is ready to perform its designated tasks.</li><br>
                        <li><span class="code-inline">process(self, data)</span>: This method is the core of the plugin class, responsible for implementing the plugin's logic and processing the incoming data. It is invoked each time new data becomes available. Within this method, you can define how the data should be handled, transformed, or analyzed, making it a crucial part of the plugin's functionality.</li><br>
                        <li><span class="code-inline">create_plot_widget(self)</span>: This method is responsible for creating graphical widgets that visualize data and allow user interaction, such as adjusting parameters or settings. While this method is optional, if it returns a QWidget, the framework will automatically display the widget, making it immediately available for use. This feature enhances the plugin's interactivity and provides a user-friendly interface for real-time data manipulation and visualization.
                        <br>
                        <p>Refer to the <a href="#plugin_with_gui_tutorial" class="link-in-text">Plugin with GUI</a> Tutorial for more details on this functionality.</p>
                        </li>
                    </ul>
                    <p>To help you get started, here is an example code skeleton of a plugin:</p>
                    <div class="code-container" id="plugin-code">
                        <button class="copy-btn" onclick="copyCode('code-block-7')">
                            <img src="Icon/copy_paste_icon.png" alt="Copy">
                        </button>
                        <button class="download-btn" onclick="downloadPythonFile('code-block-7', 'DummyPlugin.py')">
                            <img src="Icon/download_icon.png" alt="Download">
                        </button>
                        
                        <pre><code class="language-python" id="code-block-7">from st_hsdatalog.HSD_datatoolkit.HSD_DataToolkit_Pipeline import HSD_Plugin

        class PluginClass(HSD_Plugin):

        def __init__(self):
            super().__init__()
            print("Plugin has been initialized!")

        def process(self, data):
            print("Plugin process method called")
            print(f"--> Received data: {data}")
            return data

        def create_plot_widget(self):
            print("Plugin create_plot_widget method called")</code></pre>
                    </div>
                    <p>The <span class="code-inline">process(self, data)</span> method will receive <span class="code-inline">data</span> encapsulated in an object of the following format:</p>
                    <div class="code-container" id="HSD_DataToolkit_data">
                        <button class="copy-btn" onclick="copyCode('code-block-8')">
                            <img src="Icon/copy_paste_icon.png" alt="Copy">
                        </button>
                        <pre><code class="language-python" id="code-block-8">class HSD_DataToolkit_data:
        def __init__(self, comp_name, data, timestamp):
            self.comp_name = comp_name
            self.data = data
            self.timestamp = timestamp</code></pre>
                    </div>
                    <p>In this <span class="code-inline">HSD_DataToolkit_data</span> class:</p>
                    <ul>
                        <li><span class="code-inline">comp_name</span>: Is a string representing the name of the sensor that is sending the data.</li><br>
                        <li><span class="code-inline">data</span>: Contains the actual sensor data, which could be in various formats depending on the sensor type.</li><br>
                        <li><span class="code-inline">timestamp</span>: Is the timestamp indicating the most recent data point in the data buffer.</li>
                    </ul>
                    <p>In this simple plugin, each time new data is available, the <span class="code-inline">process(self, data)</span> will be called notifying the user by printing a message to the console:</p>

                    <div class="code-container" id="code-block-9">
                        <button class="copy-btn" onclick="copyCode('code-block-9')">
                            <img src="Icon/copy_paste_icon.png" alt="Copy">
                        </button>
                        <pre><code class="language-python">print(f"--> Received data: {data}")</code></pre>
                    </div>
                    <p> This print statement outputs a message that includes the received data, providing a simple way to verify that data is being received and processed correctly.</p>
                </div>
            </div>
        </section>

        <section id="how_to_configure_pipeline" class="tutorials-section">
            <div class="foldable open">
                <header class="header" onclick="toggleFold(this)">
                    <h1>How to configure the Plugins Pipeline</h1>
                    <span class="arrow">&#9654;</span>
                </header>
                <div class="intro">
                    <h2>Open the High-Speed Datalog Control SW</h2>
                    <p>Connect a board compatible with the FP-SNS-DATALOG2 to your PC and follow these steps:</p>
                    <ol>
                        <li>Ensure you have followed the steps in the <a href="#download-and-configure" class="link-in-text">Download and Configure</a> section</li>
                        <li>In the final step of the configuration, you should have executed the
                            <span class="code-inline">hsdatalog_GUI.py</span> script. This will open the Datalog Software GUI, as illustrated in the image below:</li>
                    </ol>
                    <img src="Img/HSDatalog_connect_img.png" id="datalog_connect" alt="Datalog Connection" style="width: 100%; height: auto;">
                    <h2 id="enable-datatoolkit-feature">Enable the DataToolkit feature</h2>
                    <p>To enable the DataToolkit feature, open the <strong>"Experimental Features"</strong> page by clicking the potion icon as shown in the image below.</p>
                    <img src="Img/enable_experimental_feature.png" alt="experimental features btn" style="height: auto;">
                    <p>Activate the DataToolkit feature by enabling the dedicated checkbox.</p>
                    <img src="Img/zoom_datatoolKit_checkbox_greenbox.png" alt="enable datatoolKit" style="height: auto;">
                    <h2>Plugins folder selection</h2>
                    <p>Once the DataToolkit feature is enabled, the <strong>"Selected Plugin List"</strong> will appear empty.</p>
                    <img src="Img/experimental_features_page.jpg" alt="experimental feature page" style="width: 100%; height: auto;">
                    <p>Click <strong>"Browse"</strong> to select a folder containing one or more valid <a href="#what-is-a-plugin" class="link-in-text">Plugin</a> Python files.</p>
                    <img src="Img/zoom_datatoolKit_browse_greenbox.png" alt="datatoolKit browse btn" style="height: auto;">
                    <p>Each <a href="#tutorials-section" class="link-in-text">Tutorial</a> in this guide comes with a dedicated folder with the required plugin files. These folders are located in the <span class="code-inline">HSDPython_SDK/data_toolkit_plugins/tutorials</span> directory.</p>
                    <p>For example, to load the <strong>HelloWorldPlugin</strong>, select the <span class="code-inline">HSDPython_SDK/data_toolkit_plugins/tutorials/simple/HelloWorld</span> directory.</p>
                    <p>Once the folder is selected, the <strong>"Selected Plugin List"</strong> will display the loaded plugin like shown in the image below.</p>
                    <img src="Img/helloworld_plugin_used.png" alt="Final Result" style="width: 100%; height: auto;">
                </div>
            </div>
        </section>
        
        <section id="supported-platforms" class="tutorials-section">
            <div class="foldable open">
                <header class="header" onclick="toggleFold(this)">
                    <h1>Supported Platforms</h1>
                    <span class="arrow">&#9654;</span>
                </header>
                <div class="intro">
                    <div class="platforms-section">
                        <div class="platform-card">
                            <h3><a href="https://www.st.com/en/evaluation-tools/steval-stwinbx1.html" class="link">STEVAL-STWINBX1</a></h3>
                            <img src="Img/Platforms/STEVAL-STWINBX1.jpg" alt="STEVAL-STWINBX1">
                            <p>STWIN.box - SensorTile Wireless Industrial Node Development Kit</p>
                        </div>
                        <div class="platform-card">
                            <h3><a href="https://www.st.com/en/evaluation-tools/steval-stwinkt1b.html" class="link">STEVAL-STWINKT1B</a></h3>
                            <img src="Img/Platforms/STEVAL-STWINKT1B.jpg" alt="STEVAL-STWINKT1B">
                            <p>STWIN - SensorTile Wireless Industrial Node Development Kit</p>
                        </div>
                        <div class="platform-card">
                            <h3><a href="https://www.st.com/en/evaluation-tools/steval-mkboxpro.html" class="link">STEVAL-MKBOXPRO</a></h3>
                            <img src="Img/Platforms/STEVAL-MKBOXPRO.jpg" alt="STEVAL-MKBOXPRO">
                            <p>SensorTile.box PRO - Multi-sensors and wireless connectivity for any intelligent IoT node.</p>
                        </div>
                        <div class="platform-card">
                            <h3><a href="https://www.st.com/en/evaluation-tools/b-u585i-iot02a.html" class="link">B-U585I-IOT02A</a></h3>
                            <img src="Img/Platforms/B-U585I-IOT02A.jpg" alt="B-U585I-IOT02A">
                            <p>Discovery kit for IoT node with STM32U5 series</p>
                        </div>
                        <div class="platform-card">
                            <h3><a href="https://www.st.com/en/evaluation-tools/nucleo-h7a3zi-q.html" class="link">NUCLEO-H7A3ZI-Q</a></h3>
                            <img src="Img/Platforms/NUCLEO-H7A3ZI-Q.jpg" alt="NUCLEO-H7A3ZI-Q">
                            <p>STM32 Nucleo-144 development board with STM32H7A3ZI MCU, SMPS, supports Arduino, ST Zio and morpho connectivity.</p>
                        </div>
                        <div class="platform-card">
                            <h3><a href="https://www.st.com/en/evaluation-tools/nucleo-h7a3zi-q.html" class="link">NUCLEO-U575ZI-Q</a></h3>
                            <img src="Img/Platforms/NUCLEO-U575ZI-Q.jpg" alt="NUCLEO-U575ZI-Q">
                            <p>STM32 Nucleo-144 development board with STM32U575ZIT6Q MCU, SMPS, supports Arduino, ST Zio and morpho connectivity.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="tutorials-section" class="tutorials-section">
            <div class="foldable open">
                    <header class="header" onclick="toggleFold(this)">
                    <h1>Tutorials</h1>
                    <span class="arrow">&#9654;</span>
                </header>
                <div class="intro">
                    <p>The DataToolkit tutorials are detailed guides designed to help you master the framework, regardless of whether you are a beginner or an expert. </p>
                    <section>
                        <h2 class="section-title">For beginners</h2>
                        <p>Explore the following tutorials to get familiar with the DataToolkit framework.</p>
                        <div class="tutorials">
                            <div class="tutorial-card">
                                <h3><a href="#helloworld_plugin_tutorial" class="link">Hello World Plugin</a></h3>
                                <p>This "Hello, World!" tutorial shows the basic structure of a plugin.</p>
                            </div>
                            <div class="tutorial-card">
                                <h3><a href="#chained_plugins_tutorial" class="link">Chained Plugins</a></h3>
                                <p>Connect multiple plugins together to form a process pipeline.</p>
                            </div>
                            <div class="tutorial-card">
                                <h3><a href="#plugin_with_gui_tutorial" class="link">Plugin with GUI</a></h3>
                                <p>Shows how to create a GUI widget to plot your processed data.</p>
                            </div>
                        </div>
                    </section>
                    <section>
                        <h2 class="section-title">For experts</h2>
                        <p>Dive deeper into the DataToolkit framework with these advanced tutorials designed for experienced users.</p>
                        <div class="tutorials">
                            <div class="tutorial-card">
                                <h3><a href="#csv_data_save_plugin_tutorial" class="link">CSV data Plugin</a></h3>
                                <p>Learn how to create a plugin that saves processed data into a CSV file.</p>
                            </div>
                            <div class="tutorial-card">
                                <h3><span class="link">Coming soon...</span></h3>
                                <p>Stay tuned for more advanced tutorials that will help you leverage the full potential of the DataToolkit framework.</p>
                            </div>
                            <!-- <div class="tutorial-card">
                                <h3><a href="#hsd_callbacks_plugin_tutorial" class="link">HSD Callbacks Plugin</a></h3>
                                <p>Learn how to implement and manage High-Speed Datalog callbacks for starting and stopping logs, as well as for data tagging.</p>
                            </div>
                            <div class="tutorial-card">
                                <h3><a href="#inclination_game_plugin_tutorial" class="link">Inclination Game Plugin</a></h3>
                                <p>Plugin to visualize inclination data using a scatter plot and a rectangular threshold indicator within a customizable plot widget.</p>
                            </div> -->
                        </div>
                    </section>
                </div>
            </div>
        </section>
        
        <section id="helloworld_plugin_tutorial" class="tutorials-section">
            <div class="foldable open">
                <header class="header" onclick="toggleFold(this)">
                    <h1>Hello World Plugin</h1>
                    <span class="arrow">&#9654;</span>
                </header>
                <div class="intro">
                    <p>The HelloWorld plugin is designed as an introductory example to help you get started with the DataToolkit framework.
                        This tutorial demonstrates the basic structure and functionality of a plugin.</p>
                    <p>Before starting this tutorial, ensure that your system is configured correctly. Follow the instructions in the
                        <a href="#download-and-configure" class="link-in-text">Download and Configure</a> and
                        <a href="#how_to_configure_pipeline" class="link-in-text">How to configure the Plugins Pipeline</a> sections.</p>
                    
                    <h2>Select the Plugin Folder</h2>
                    <p>From the <a href="#enable-datatoolkit-feature" class="link-in-text">DataToolkit GUI section</a>, select the <strong>HelloWorld</strong> plugin folder located in the <span class="code-inline">HSDPython_SDK/data_toolkit_plugins/tutorials/simple</span> directory.</p>
                    
                    <img src="Img/helloworld_plugin_enable.png" alt="start log" style="width: 100%; height: auto;">

                    <h2>Connect and configure your target</h2>
                    <p>Return to the connection page by clicking the plug button and connect your <strong>FP-SNS-DATALOG2-compatible</strong> board by clicking the <strong>Connect</strong> button.
                        Enable the sensors you want to use by clicking the corresponding checkboxes. Their data will be streamed to the Datalog application and through the DataToolkit framework.</p>
                    <p> For this simple example we enabled only the <strong>IIS3DWB</strong> accelerometer sensor as shown in the image below (this is just an example to simplify the tutorial;
                        you can enable any sensor you want and also more than one at the same time).</p>
                    <img src="Img/enable_IIS3dWB_ACC.png" alt="start log">
                    <br>
                    <h2>Start the acquisition</h2>                
                    <p>Click <strong>Start Log</strong> to start the data acquisition process.</p>
                    
                    <img src="Img/start_log_greenbox.png" alt="start log" style="width: 100%; height: auto;">
                    <p>IIS3DWB_ACC data will be streamed to the Datalog application as shown in the figure below.</p>
                    <img src="Img/IIS3DWB_ACC_streaming.png" alt="IIS3DWB_ACC streaming" style="width: 100%; height: auto;">
                    <p>At the same time, the data stream is routed to the DataToolkit Pipeline and processed by the <strong>HelloWorldPlugin</strong> plugin (since is the only plugin loaded). </p>
                    
                    <h2>Plugin Code</h2>
                    <p>Here is the code for the <span class="code-inline">HelloWorldPlugin.py</span> plugin:</p>
                    <div class="code-container">
                        <button class="copy-btn" onclick="copyCode('code-block-12')">
                            <img src="Icon/copy_paste_icon.png" alt="Copy">
                        </button>
                        <button class="download-btn" onclick="downloadPythonFile('code-block-12', 'HelloWorldPlugin.py')">
                            <img src="Icon/download_icon.png" alt="Download">
                        </button>
                        <pre><code class="language-python" id="code-block-12">
from st_hsdatalog.HSD_datatoolkit.HSD_DataToolkit_Pipeline import HSD_Plugin

class PluginClass(HSD_Plugin):

    def __init__(self):
        super().__init__()
        print("HelloWorldPlugin has been initialized!")
    
    def process(self, data):
        print("HelloWorldPlugin process method called")
        print(f"---> Received data from: {data.comp_name}")
        print(f"-----> Data: {data.data}")
        print(f"-----> Timestamp: {data.timestamp}")
        return data

    def create_plot_widget(self):
        print("HelloWorldPlugin create_plot_widget method called")
                        </code></pre>
                    </div>
                    <p>To see the <strong>HelloWorldPlugin</strong> in action, you can see the console output in the Datalog application as shown in the image below.</p>
                    <img src="Img/helloworld_plugin_console_output.png" alt="helloworld plugin console output">
                    <p>As you can see, the <span class="code-inline">process</span> method is invoked automatically each time new IIS3DWB_ACC data are available.</p>
                    <p>The <span class="code-inline">process</span> method receives as input data, an instance of the <a href="#HSD_DataToolkit_data" class="link">HSD_DataToolkit_data</a> class. Where the data attribute
                        is a numpy array containing the IIS3DWB_ACC data.</p>
                    <p> Here is the detailed description of the data object received by the <span class="code-inline">process</span> method:</p>
                    <div class="code-container" id="code-block-8">
                        <button class="copy-btn" onclick="copyCode('code-block-8')">
                            <img src="Icon/copy_paste_icon.png" alt="Copy">
                        </button>
                        <pre><code class="language-python" id="code-block-8">
    data.comp_name = "component_name" (string)
    data.data = ([acc_x, acc_y, acc_z, acc_x, acc_y, acc_z, ...], dtype('float64'))
    data.timestamp = &lt;double_value&gt; 
                        </code></pre>
                    </div>                
                    
                    <h2>Stop the acquisition</h2>
                    <p>Click <strong>Stop Log</strong> to stop the data acquisition process.</p>
                    <P>The tutorial is now complete. You have successfully run your first plugin with the DataToolkit framework.
                    You can now close the Datalog application and explore more tutorials to further enhance your knowledge.</p>
                </div>
            </div>
        </section>
        
        <section id="chained_plugins_tutorial" class="tutorials-section">
            <div class="foldable open">
                <header class="header" onclick="toggleFold(this)">
                    <h1>Chained Plugins</h1>
                    <span class="arrow">&#9654;</span>
                </header>
                <div class="intro">
                    <p>The Chained Plugins tutorial is designed to help you understand how to connect multiple plugins to form a process pipeline. 
                       This tutorial demonstrates the modularity and scalability of the DataToolkit framework by allowing users to split complex processes into different blocks. 
                       For example, a filtering phase followed by a control algorithm can be split into two plugins: Filter and Control Algorithm, which can be reused in the future like "Lego" blocks.</p>
                    
                    <p>In this tutorial, we will use two plugins called <span class="code-inline">FilterPlugin.py</span> and <span class="code-inline">ProcessPlugin.py</span> to filter and process data from a <strong>IIS3DWB</strong> accelerometer sensor.</p> 
                    
                    <p>Before starting this tutorial, ensure that your system is configured correctly. Follow the instructions in the
                        <a href="#download-and-configure" class="link-in-text">Download and Configure</a> and
                        <a href="#how_to_configure_pipeline" class="link-in-text">How to configure the Plugins Pipeline</a> sections.</p>

                    <h2>Select the Plugin Folder</h2>
                    <p>From the <a href="#enable-datatoolkit-feature" class="link-in-text">DataToolkit GUI section</a>, select the <strong>ChainedPlugins</strong> plugin folder located in the <span class="code-inline">HSDPython_SDK/data_toolkit_plugins/tutorials/simple</span> directory.
                       The plugin folder contains two plugin called:  <span class="code-inline">FilterPlugin.py</span> and <span class="code-inline">ProcessPlugin.py</span>.
                    </p>

                    <img src="Img/ChainedPlugins_selected.png" alt="start log" style="width: 100%; height: auto;">

                    <h2>Connect and configure your target</h2>
                    <p>Return to the connection page by clicking the plug button and connect your <strong>FP-SNS-DATALOG2-compatible</strong> board by clicking the <strong>Connect</strong> button.
                        Then enable the <strong>IIS3DWB</strong> sensor by clicking its corresponding checkbox. <strong>IIS3DWB</strong> data will be streamed to the Datalog application and through the DataToolkit framework.</p>
                    </p>
                    <img src="Img/enable_IIS3dWB_ACC.png" alt="enable IIS3dWB_ACC">
                    <br>
                    <h2>Start the acquisition</h2>                
                    <p>Click <strong>Start Log</strong> to start the data acquisition process.</p>
                    <img src="Img/start_log_greenbox.png" alt="start log" style="width: 100%; height: auto;">
                    <p>IIS3DWB_ACC data will be streamed to the Datalog application as shown in the figure below.</p>
                    <img src="Img/IIS3DWB_ACC_streaming.png" alt="IIS3DWB_ACC streaming" style="width: 100%; height: auto;">
                    <p>Simultaneously, the same data is routed to the DataToolkit Pipeline for processing. The IIS3DWB sensor data will first be processed by the <strong>FilterPlugin</strong>, and its output will then be used as input for the subsequent <strong>ProcessPlugin</strong>.</p>
                    <p>Each time new IIS3DWB sensor data becomes available, it will be processed by the entire plugin pipeline before processing the next IIS3DWB sensor data.</p>

                    <h2>Plugin Code</h2>
                    <p>Here is the code for the <span class="code-inline">FilterPlugin.py</span> plugin:</p>
                    
                    <div class="code-container">
                        <button class="copy-btn" onclick="copyCode('code-block-12')">
                            <img src="Icon/copy_paste_icon.png" alt="Copy">
                        </button>
                        <button class="download-btn" onclick="downloadPythonFile('code-block-12', 'FilterPlugin.py')">
                            <img src="Icon/download_icon.png" alt="Download">
                        </button>
                        <pre><code class="language-python" id="code-block-12">
        from st_hsdatalog.HSD_datatoolkit.HSD_DataToolkit_Pipeline import HSD_Plugin
        import numpy as np
        
        class PluginClass(HSD_Plugin):
        
            def __init__(self):
                super().__init__()
                print("FilterPlugin has been initialized!")
            
            def process(self, data):
                if data.comp_name == "iis3dwb_acc":
                    # Extract the x, y, and z components of the accelerometer data
                    acc_x = data.data[0::3]
                    acc_y = data.data[1::3]
                    acc_z = data.data[2::3]
                    # Calculate the norm of the accelerometer data
                    acc_data_norm = np.sqrt(acc_x**2 + acc_y**2 + acc_z**2)
                    # Update the data with the calculated norm
                    data.data = acc_data_norm
                return data
        
            def create_plot_widget(self):
                print("FilterPlugin create_plot_widget method called")
                        </code></pre>
                    </div>

                    <p>The <span class="code-inline">FilterPlugin.py</span> will receive IIS3DWB_ACC data as input and compute the norm of the three axes. 
                        This plugin is responsible for filtering the data before it is passed to the next stage.</p>

                    <p>Here is the code for the <span class="code-inline">ProcessPlugin.py</span> plugin:</p>

                    <div class="code-container" id="filterPlugin">
                        <button class="copy-btn" onclick="copyCode('code-block-8')">
                            <img src="Icon/copy_paste_icon.png" alt="Copy">
                        </button>
                        <button class="download-btn" onclick="downloadPythonFile('code-block-8', 'ProcessPlugin.py')">
                            <img src="Icon/download_icon.png" alt="Download">
                        </button>
                        <pre><code class="language-python" id="code-block-8">
    from st_hsdatalog.HSD_GUI.HSD_DataToolkit_Pipeline import HSD_Plugin
    import numpy as np 

    class PluginClass(HSD_Plugin):

        def __init__(self, components_status):
            super().__init__(components_status)
            self.control_thr = 1.7
            print("ProcessPlugin has been initialized!")
        
        def process(self, data):
            if data.comp_name == "iis3dwb_acc":
                if np.any(data.data >= self.control_thr):
                    print("Warning data above threshold !!")
            return data

        def create_plot_widget(self):
            print("ProcessPlugin create_plot_widget method called")                        
                        </code></pre>
                    </div>

                    <p>The <span class="code-inline">ProcessPlugin.py</span> will implement a simple control algorithm that evaluates if the input is above a control threshold and prints "Warning data above threshold !!" if it is.</p>
                    <p>To see these plugins in action, you can view the console output in the Datalog application as shown in the image below. 
                        Move your board; each time the filtered data is above the threshold, the message "Warning data above threshold !!" will be displayed in the console.</p>
                    
                    <img src="Img/ChainedPlugins_console_output.png" alt="ChainedPlugins console output">
                    <br>

                    <h2>Stop the acquisition</h2>
                    <p>Click <strong>Stop Log</strong> to stop the data acquisition process.</p>
                    <p>The tutorial is now complete. You have successfully run two chained plugins forming a data processing pipeline.
                        You can now close the Datalog application and explore more tutorials to further enhance your knowledge.</p>
                </div>
            </div>
        </section>

        <section id="plugin_with_gui_tutorial" class="tutorials-section">
            <div class="foldable open">
                <header class="header" onclick="toggleFold(this)">
                    <h1>Plugin with GUI</h1>
                    <span class="arrow">&#9654;</span>
                </header>
                <div class="intro">
                    <p>This tutorial is an introductory example designed to guide you through the process of creating a simple graphical user interface (GUI) to visualize the data generated by your plugins.</p>
                    <p>In this tutorial, you will compute the norm of the IIS3DWB accelerometer data and plot the result on a graph.</p>
                    
                    <p>Before starting, ensure that your system is configured correctly. Follow the instructions in the
                        <a href="#download-and-configure" class="link-in-text">Download and Configure</a> and
                        <a href="#how_to_configure_pipeline" class="link-in-text">How to configure the Plugins Pipeline</a> sections.</p>

                    <h2>Select the Plugin Folder</h2>
                    <p>From the <a href="#enable-datatoolkit-feature" class="link-in-text">DataToolkit GUI section</a>, select the <strong>PluginWithGUI</strong> plugin folder located in the <span class="code-inline">
                       HSDPython_SDK/data_toolkit_plugins/tutorials/simple</span> directory.</p>
                    
                    <img src="Img/GUIPlugin_selected.png" alt="GUIPlugin selected" style="width: 100%; height: auto;">

                    <h2>Connect and configure your target</h2>
                    <p>Return to the connection page by clicking the plug button and connect your <strong>FP-SNS-DATALOG2-compatible</strong> board by clicking the <strong>Connect</strong> button.
                        Then enable the <strong>IIS3DWB</strong> sensor by clicking its corresponding checkbox. <strong>IIS3DWB</strong> data will be streamed to the Datalog application and through the DataToolkit framework.</p>
                    <img src="Img/enable_IIS3dWB_ACC.png" alt="enable IIS3dWB_ACC">
                    
                    <p>As you can see in the figure below, a new graph for the plugin data has been added on the right section of the Datalog application.</p>
                    <img src="Img/FilterPlugin_GUI_graphWidget_greenbox.png" alt="Graphic widget plugin" style="width: 100%; height: auto;">
                    
                    <h2>Start the acquisition</h2>                
                    <p>Click <strong>Start Log</strong> to start the data acquisition process.</p>
                    <img src="Img/FilterPlugin_GUI_graphWidget_startlog.png" alt="Graphic widget plugin start log" style="width: 100%; height: auto;">
                    <p>IIS3DWB_ACC data will be streamed to the Datalog application and the plugin process data will be displayed by the new added graph, as shown in the figure below.</p>
                    <img src="Img/FilterPlugin_logging.png" alt="Graphic widget logging" style="width: 100%; height: auto;">

                    <h2>Plugin Code</h2>
                    <p>Here is the code for the <span class="code-inline">FilterPlugin_GUI.py</span> plugin:</p>

                    <div class="code-container" id="filterPluginGUI">
                        <button class="copy-btn" onclick="copyCode('code-block-11')">
                            <img src="Icon/copy_paste_icon.png" alt="Copy">
                        </button>
                        <button class="download-btn" onclick="downloadPythonFile('code-block-11', 'filterPluginGUI.py')">
                            <img src="Icon/download_icon.png" alt="Download">
                        </button>
                        <pre><code class="language-python" id="code-block-11">
        from st_hsdatalog.HSD_datatoolkit.HSD_DataToolkit_Pipeline import HSD_Plugin
        from st_dtdl_gui.Widgets.Plots.PluginPlotWidget import PluginPlotWidget, PluginPlotType
        import numpy as np
        
        class PluginClass(HSD_Plugin):
        
            def __init__(self):
                super().__init__()
                print("FilterPlugin has been initialized!")
            
            def process(self, data):
                if data.comp_name == "iis3dwb_acc":
                    # Extract the x, y, and z components of the accelerometer data
                    acc_x = data.data[0::3]
                    acc_y = data.data[1::3]
                    acc_z = data.data[2::3]
                    # Calculate the norm of the accelerometer data
                    acc_data_norm = np.sqrt(acc_x**2 + acc_y**2 + acc_z**2)
                    
                    # Add data to the Plot Widget
                    self.plot_widget.add_data([acc_data_norm])
        
                    # Update the data with the calculated norm
                    data.data = acc_data_norm
                return data
        
            def create_plot_widget(self):
                print("FilterPlugin create_plot_widget method called")
                self.plot_widget = PluginPlotWidget.create_plot("FilterPlugin", PluginPlotType.LINE, dimension=1)
                return self.plot_widget
                        </code></pre>
                    </div>

                <p>This plugin compute the norm of the IIS3DWB accelerometer data and plot the result on the dedicated graph.</p>
            
                <p>In order to plot the plugin data user needs to:</p>
                <ol>
                    <li>
                        <p>Import the necessary modules</p>
                        <div class="code-container" id="createPlotMethod">
                            <pre>
                                <code class="language-python">
    from st_hsdatalog.HSD_GUI.HSD_DataToolkit_Pipeline import PluginPlotWidget, PluginPlotType
                                </code>
                            </pre>
                        </div>
                    </li>
                    <li>
                        <p>Instantiate the Plot Widget</p>
                        <div class="code-container" id="createPlotMethod">
                            <pre>
                                <code class="language-python">
    def create_plot_widget(self):
        print("FilterPlugin create_plot_widget method called")
        self.plot_widget = PluginPlotWidget.create_plot("FilterPlugin", PluginPlotType.LINE, dimension=1)
        return self.plot_widget</code>
                            </pre>
                        </div>
                <p>The <span class="code-inline">PluginPlotWidget.create_plot()</span> method allows you to create a Plot Widget based on the specified parameters. Here is the method declaration and how to use it:</p>
            
                <div class="code-container" id="createPlotMethod">
                        <pre><code class="language-python" id="code-block-10">
    class PluginPlotWidget:
        
        @staticmethod
        def create_plot(plot_name, plot_type: PluginPlotType, dimension, unit=""):
            """
            Create a plot widget based on the plot parameters.
    
            @param plot_name: The name of the plot.
            @type plot_name: str
    
            @param plot_type: The type of the plot. Must be an instance of PluginPlotType.
            @type plot_type: PluginPlotType
    
            @param dimension: The dimensions of the plot.
            @type dimension: Any (Specify the exact type if known)
    
            @param unit: The unit of measurement for the plot dimensions. Default is an empty string.
            @type unit: str, optional
    
            @return: A plot widget instance if the plot type is valid, otherwise None.
            @rtype: PlotLinesWidget or None
            """
                        </code></pre>
                </div>
                </li>
                <li>
                    <p>Send the plugin processed data to the Plot Widget by calling:</p>
                    <div class="code-container" id="createPlotMethod">
                        <pre>
                            <code class="language-python">
    # Add data to the Plot Widget
    self.plot_widget.add_data([acc_data_norm])
                            </code>
                        </pre>
                    </div>
                </li>
            </ol>
            
            <p>To see the <strong>FilterPlugin_GUI</strong> in action, you can view the signal plotted in the Datalog application
                as shown in the image above. The graph will display the norm value of the IIS3DWB accelerometer data,
                allowing you to visualize the processed data in real-time. This provides a clear and immediate way to verify that
                the plugin is functioning correctly and that the data is being processed and displayed as expected.</p>

            <h2>Stop the acquisition</h2>
                <p>Click <strong>Stop Log</strong> to stop the data acquisition process.</p>
                <P>The tutorial is now complete. You have successfully run a plugin with a graphical user interface to visualize the processed data.
                You can now close the Datalog application and explore more tutorials to further enhance your knowledge.</p>
            </div>
        </section>

        <section id="csv_data_save_plugin_tutorial" class="tutorials-section">
            <div class="foldable open">
                <header class="header" onclick="toggleFold(this)">
                    <h1>CSV Data Plugin</h1>
                    <span class="arrow">&#9654;</span>
                </header>
                <div class="intro">
                    <p>The CSV data Plugin tutorial demonstrates how to create a plugin that saves processed data into a CSV file.</p>
                    <p>Before starting this tutorial, ensure that your system is configured correctly. Follow the instructions in the
                        <a href="#download-and-configure" class="link-in-text">Download and Configure</a> and
                        <a href="#how_to_configure_pipeline" class="link-in-text">How to configure the Plugins Pipeline</a> sections.</p>
                    
                    <h2>Select the Plugin Folder</h2>
                    <p>From the <a href="#enable-datatoolkit-feature" class="link-in-text">DataToolkit GUI section</a>, select the <strong>CSVdataSave</strong> plugin folder located in the <span class="code-inline">HSDPython_SDK/data_toolkit_plugins/tutorials/advanced</span> directory.</p>
                    <p>Selected Plugins list should look like this:</p>
                    <img src="Img/save_csv_selected_plugins.png" alt="CSV Data Plugin list" style="width: 100%; height: auto;"> 

                    <h2>Connect and configure your target</h2>
                    <p>Return to the connection page by clicking the plug button and connect your <strong>FP-SNS-DATALOG2-compatible</strong> board by clicking the <strong>Connect</strong> button.
                        Enable the sensors you want to use by clicking the corresponding checkboxes. Their data will be streamed to the Datalog application and through the DataToolkit framework.</p>
                    <img src="Img/save_csv_sensors_enabled.png" alt="CSV Data plugin sensors enabled" style="width: 100%; height: auto;">
                    
                    <h2>Start the acquisition</h2>                
                    <p>Click <strong>Start Log</strong> to start the data acquisition process.</p>
                    <img src="Img/save_csv_start_log.png" alt="CSV Data plugin start log" style="width: 100%; height: auto;">
                    <p>Selected sensor data will be streamed to the Datalog application as shown in the figure below.</p>
                    <img src="Img/save_csv_plugin_streaming.png" alt="CSV Data plugin streamning" style="width: 100%; height: auto;">
                    <p>At the same time, the data stream is routed to the DataToolkit Pipeline and processed by the <strong>CSVDataSavePlugin</strong> plugin (since is the only plugin loaded). </p>
                    
                    <h2>Plugin Code</h2>
                    <p>Here is the code for the <span class="code-inline">CSVDataSavePlugin.py</span> plugin:</p>
                    <div class="code-container">
                        <button class="copy-btn" onclick="copyCode('code-block-12')">
                            <img src="Icon/copy_paste_icon.png" alt="Copy">
                        </button>
                        <button class="download-btn" onclick="downloadPythonFile('code-block-12', 'CSVDataSavePlugin.py')">
                            <img src="Icon/download_icon.png" alt="Download">
                        </button>
                        <pre><code class="language-python" id="code-block-12">
import os
import threading
import queue
import numpy as np
import pandas as pd
from datetime import datetime
from st_hsdatalog.HSD_datatoolkit.HSD_DataToolkit_Pipeline import HSD_DataToolkit_data, HSD_Plugin

OUTPUT_DIR = os.path.dirname(os.path.abspath(__file__))

class PluginClass(HSD_Plugin):
    def __init__(self):
        super().__init__()
        print("CSVDataSavePlugin has been initialized!")
        self.output_dir = OUTPUT_DIR
        self.components_files = {}
        self.data_queues = {}
        self.writer_threads = {}
        
        if not os.path.exists(self.output_dir):
            os.makedirs(self.output_dir)
    
    # Method to recreate timestamps based on the last timestamp, number of samples, and output data rate (odr)
    def _recreate_timestamps(self, last_timestamp, num_samples, odr):
        interval = 1.0 / odr
        timestamps = [last_timestamp - (num_samples - 1 - i) * interval for i in range(num_samples)]
        return timestamps

    # Initialize the CSV file with headers
    def _initialize_csv(self, file_name, headers):
        print("Initializing CSV file")
        df = pd.DataFrame(columns=headers)
        df.to_csv(file_name, mode='w', header=True, index=False)

    # Function to save a batch of data to CSV
    def _save_batch_to_csv(self, data_batch, file_name):
        # Ensure data_batch is a 2D array
        data_batch_2d = np.vstack(data_batch)
        df = pd.DataFrame(data_batch_2d)
        df.to_csv(file_name, mode='a', header=False, index=False)

    # Worker function to write data from the queue to the CSV file
    def _writer_worker(self, data_queue, file_name, batch_size):
        batch = []
        while True:
            data_chunk = data_queue.get()
            if data_chunk is None:
                if batch:
                    self._save_batch_to_csv(batch, file_name)
                break
            batch.append(data_chunk)
            if len(batch) >= batch_size:
                self._save_batch_to_csv(batch, file_name)
                batch = []
            data_queue.task_done()
    
    # Process incoming data and add it to the queue
    def process(self, data:HSD_DataToolkit_data):
        component_name = data.comp_name
        if component_name not in self.components_status:
            print(f"Component {component_name} not found in components_status")
            return
        odr = self.components_status[component_name].get('odr', 1)
        dim = self.components_status[component_name].get('dim', 1)
        num_samples = len(data.data) // dim
        timestamps = self._recreate_timestamps(data.timestamp, num_samples, odr)
        axis_data = np.array([data.data[j::dim] for j in range(dim)])
        combined_data = np.column_stack((timestamps, axis_data.T))
        self.data_queues[component_name].put(combined_data)

    # Create a plot widget (currently just a placeholder)
    def create_plot_widget(self):
        print("CSVDataSavePlugin create_plot_widget method called")
    
    # Start logging callback, initializes CSV files and writer threads for each component and starts the writer threads
    def start_log_cb(self):
        current_time = datetime.now().strftime("%Y%m%d_%H_%M_%S")
        for component_name, status in self.components_status.items():
            if status.get('enable', False):
                csv_file_path = os.path.join(self.output_dir, f"{component_name}_{current_time}.csv")
                self.components_files[component_name] = csv_file_path
                header = ["Time"]
                header.extend([f"Data_axis_{i}" for i in range(status.get('dim', 1))])
                batch_size = 5  # Number of chunks per batch
                self.data_queues[component_name] = queue.Queue()
                # Initialize the CSV file
                self._initialize_csv(csv_file_path, header)
                writer_thread = threading.Thread(target=self._writer_worker, args=(self.data_queues[component_name], csv_file_path, batch_size))
                self.writer_threads[component_name] = writer_thread
                self.writer_threads[component_name].start()
    
    # Stop logging callback, stops the writer threads for each component and joins them to the main thread
    def stop_log_cb(self):
        for component_name in self.components_files:
            self.data_queues[component_name].put(None)
            self.writer_threads[component_name].join()
                        </code></pre>
                    </div>
                    <p>Once the acquisition is started, for each sensor enabled, the plugin will create a CSV file
                        with the sensor name and the current timestamp as the file name.
                        By default the CSV file will be saved in the same directory as the plugin file. Change the <span class="code-inline">OUTPUT_DIR</span> variable to save the CSV file in a different directory.</p>
                    <p>The plugin then creates a header for each CSV file with a column named <span class="code-inline">Time</span>
                        to store the timestamps and a column for each sensor axis named <span class="code-inline">Data_axis_i</span>
                        (where <span class="code-inline">i</span> is the axis number), to store the sensor data.
                        sequentially, the plugin will start a writer thread for each sensor to write the data to the CSV file in batches of 5 samples.</p>
                    <p>At each <span class="code-inline">process</span> function call, the plugin will calculate the timestamps for each sample based on the last timestamp received and the ODR of the sensor.
                        Then once timestamp array is created, the plugin will combine the timestamps with the data and add it to a dedicated queue for each sensor.</p>
                    <p>The file writing process is done in a separate thread to avoid blocking the main thread. Each writer thread will write the data to the CSV file in batches of 5 samples.</p>
                    <p>When the acquisition is stopped, the plugin will signal all writer threads to finish writing the data and close the CSV files.</p>
                    
                    <p>To see the <strong>CSVDataSavePlugin</strong> in action, you can inspect the CSV files created in the selected <span class="code-inline">OUTPUT_DIR</span> directory.
                        Each file will contain the timestamp and the sensor data for the enabled sensors.</p>
                    <img src="Img/saved_csv_files.png" alt="Saved CSV Files">
                    <h2>Stop the acquisition</h2>
                    <p>Click <strong>Stop Log</strong> to stop the data acquisition process.</p>
                    <P>The tutorial is now complete. You have successfully saved your processed data into a CSV file using the DataToolkit framework.</P>
                    <p>The images above display the content of the CSV files generated by the plugin, visualized using matplotlib.</p>
                    <img src="Img/iis2mdc_mag_csv.png" alt="CSV IIS2MDC_MAG Data Plot">
                    <img src="Img/ism330dhcx_acc_csv.png" alt="CSV ISM330DHCX_ACC Data Plot">
                    <img src="Img/stts22h_temp_csv.png" alt="CSV STTS22H_TEMP Data Plot">
                    <p>To verify the accuracy<span style="color:deepskyblue; font-weight: bold;">*</span> of the data saved in the CSV files, you can compare these plots with the data displayed in the Datalog application.</p>
                    <p>
                        <span style="color:deepskyblue; font-weight: bold;">* </span><span style="font-style: italic; font-size: small;">Data live plotted could
                            be sub-sampled to reduce the number of points and improve the visualization, the CSV files instead will contain all the data points.
                            This means that the comparison is not perfect but should give you a good idea of the correctness of the data saved.</span>
                    </p>
                    <p>You can now close the Datalog application and explore more tutorials to further enhance your knowledge.</p>
                </div>
            </div>
        </section>
    </main>
    <script>
        function toggleFold(element) {
            const foldableDiv = element.parentElement;
            const content = foldableDiv.querySelector('.intro');
            const arrow = foldableDiv.querySelector('.arrow');
            
            if (content.style.display === "none") {
                content.style.display = "block";
                element.style.borderRadius = "10px 10px 0 0";
                foldableDiv.classList.add('open');
            } else {
                content.style.display = "none";
                element.style.borderRadius = "10px";
                foldableDiv.classList.remove('open');
            }
        }
    </script>
    <!-- Include Prism.js JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-python.min.js"></script>
    <script>
        function copyCode(id) {
            const codeBlock = document.getElementById(id);
            const textArea = document.createElement('textarea');
            textArea.value = codeBlock.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('Code copied to clipboard');
        }
    </script>
    <script>
        function downloadPythonFile(codeBlockId, fileName) {
            var codeContent = document.getElementById(codeBlockId).textContent;
            var blob = new Blob([codeContent], { type: 'text/x-python' });
            var link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        </script>
</body>
</html>


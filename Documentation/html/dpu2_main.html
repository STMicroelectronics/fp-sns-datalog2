<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FP-SNS-DATALOG2: Digital Processing Unit v2 (DPU)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">FP-SNS-DATALOG2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dpu2_main.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Digital Processing Unit v2 (DPU)</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#dpu2_introduction">Introduction</a><ul><li class="level2"><a href="#dpu2_requirements">Main requirements</a></li>
</ul>
</li>
<li class="level1"><a href="#dpu2_prog_model">DPU programming model</a><ul><li class="level2"><a href="#dpu2_memory">DPU and memory management</a></li>
<li class="level2"><a href="#dpu2_example">Example code</a></li>
</ul>
</li>
<li class="level1"><a href="#dpu2_architecture">Architecture of a DPU</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="dpu2_introduction"></a>
Introduction</h1>
<p>Digital Processing Unit (DPU) is an eLooM-based application-level component that provides a set of processing blocks, also called DPU, which can be chained together, to apply some computation (<b>process</b>) over <b>input data</b> generated by a data source object (<a class="el" href="_i_source_observable_8h.html#a5b901a3ed28362a5d9453d74e8991238">ISourceObservable</a>), like a sensor, and generate <b>output data</b>.</p>
<p><a class="anchor" id="dpu2_fig1"></a></p><div class="image">
<img src="dpu2_use_cases.png" alt="" width="800px"/>
<div class="caption">
Fig.1 - DPU main uses cases</div></div>
<p>It depends on the <a class="el" href="emdata_main.html">EMData</a> component, also, but not only, for the data format definition. In fact a DPU manipulates multidimensional array of homogeneous data stored in <a href="https://en.wikipedia.org/wiki/Row-_and_column-major_order">raw major order</a> using the <a class="el" href="em__data__format_8h.html#aad912ddf8bcbd156b91ced740cf047a9">EMData_t</a> class.</p>
<h2><a class="anchor" id="dpu2_requirements"></a>
Main requirements</h2>
<p>According to the use cases of <a class="el" href="dpu2_main.html#dpu2_fig1">Fig.1</a> a DPU can:</p><ul>
<li><b>Attach</b> to (<b>detach</b> from) a data source</li>
<li><b>Attach</b> to (<b>detach</b> from) a DPU</li>
<li><b>Process</b> input data</li>
<li><b>Notify</b> other application objects when a new processed output is ready</li>
</ul>
<p>These are the main functional requirements that a DPU must implement and they are modeled in the <a class="el" href="_i_d_p_u2_8h.html#a28b7a8143eb954781059edc488fd8f54">IDPU2_t</a> interface, that is the base interface for all DPU.</p>
<p><a class="anchor" id="dpu2_fig2"></a></p><div class="image">
<img src="dpu2_IDPU2_t.png" alt=""/>
<div class="caption">
Fig.2 - IDPU2_t interface</div></div>
<p>Moreover a DPU must:</p><ul>
<li>Be easy to use (API simple to understand)</li>
<li>Be easy to extend (a developer must be able to create a new DPU with few effort)</li>
</ul>
<p>These last two non-functional requirements guarantee a good user experience for a developer.</p>
<h1><a class="anchor" id="dpu2_prog_model"></a>
DPU programming model</h1>
<p>DPU are designed around the concept of data to manipulate data: a DPU receives input data (<b>in_data</b>), and it processes the data to generate output data (<b>out_data</b>). A DPU attached to a data source receives data as soon as the data are generated by the data source. This means that a DPU cannot ask the data source for data, but it is activated every time it receives new input data. We can imagine it as a data stream that flows from the data source to the DPU as showed in <a class="el" href="dpu2_main.html#dpu2_fig3">Fig.3</a>.</p>
<p><a class="anchor" id="dpu2_fig3"></a></p><div class="image">
<img src="dpu2_high_level_diagram_1.png" alt="" width="900px"/>
<div class="caption">
Fig.3 - DPU2 - data stream</div></div>
<p>Another property of the DPU that we can identify from the above image is that a DPU is completely defined by its in_data, out_data and the processing function. We also want to be able to connect different data sources with their specific data format to a DPU, and, generally, the data format of the data source and the in_data can be different. This introduce a problem of data conversion that we model and solve by adding the concept of data builder. A <b>data builder</b> is an object placed between a data source and a DPU, and it is able to use the data stream to build a in_data for the DPU.</p>
<p><a class="anchor" id="dpu2_fig4"></a></p><div class="image">
<img src="dpu2_high_level_animation.gif" alt="" width="900px"/>
<div class="caption">
Fig.4 - DPU2 - high level diagram</div></div>
<p>The DPU component provides few data builders ready to use and a simple interface (<a class="el" href="_i_data_builder_8h.html#a3ff0a92b702bcc955542eaafb41ac546">IDataBuilder_t</a>) to implement new data builders:</p><ul>
<li><a class="el" href="_def_data_builder_8h.html#aedf8537cacc501abe3662b80c6304d8c">DefDataBuilder_t</a>: it can be used when the basic type (<a class="el" href="struct___e_m_data.html#acb5cfd209ba75c853d03f701e7f91679">EMData_t::type</a>) of the data generated by the data source and the in_data of the DPU are the same. It stores the data form the data stream in the DPU internal buffer, and when the in_data is ready it notifies the DPU.</li>
<li><a class="el" href="_t1to_t2_data_builder_8h.html#a9810da11a35680172a4717a6fb475d0d">T1toT2DataBuilder_t</a>: it is similar to <a class="el" href="_int16to_float_data_builder_8h.html#a43e988d00722db71bef3dab6ebe020a9">Int16toFloatDataBuilder_t</a> data builder, but it is able to convert from any type to any other thanks to an application defined conversion function (<a class="el" href="_t1to_t2_data_builder_8h.html#ac67de33875d80642b61ca65d8694ee0a">Convert_f</a>).</li>
<li><a class="el" href="_int16to_float_data_builder_8h.html#a43e988d00722db71bef3dab6ebe020a9">Int16toFloatDataBuilder_t</a>: it can be used when the basic type of the of data generated by the data source is <code>int16_t</code> and the one of the DPU in_data is <code>float</code>. It does the conversion from <code>int16_t</code> to <code>float</code> and store the data in the DPU internal buffer. When the in_data is ready it notifies the DPU. It is a slightly optimized version of <a class="el" href="_t1to_t2_data_builder_8h.html#a9810da11a35680172a4717a6fb475d0d">T1toT2DataBuilder_t</a>.</li>
</ul>
<h2><a class="anchor" id="dpu2_memory"></a>
DPU and memory management</h2>
<p>In a embedded application the memory (internal or external RAM, etc.) is a limited resource. The amount of memory used by a DPU to store and process the data changes from application to application, from few KB to tens or hundreds of KB, or even more. A DPU needs two blocks of memory, one to store the payload of one or more in_data (called signal) and and another to store the payload of one out_data as displayed in <a class="el" href="dpu2_main.html#dpu2_fig5">Fig.5</a>.</p>
<p><a class="anchor" id="dpu2_fig5"></a></p><div class="image">
<img src="dpu2_memory_managment.jpg" alt="" width="900px"/>
<div class="caption">
Fig.5 - DPU2 - memory buffers</div></div>
<p>Following the design principles of <a class="el" href="e_loo_m_main.html">eLooM framework</a> the DPU does not allocate big chunk of memory, but it delegate the application. The rationale is that, only at application level is possible to select where to allocate a memory block according to the specific embedded application. Instead a DPU provides easy to use API to set the data buffer:</p><ul>
<li><a class="el" href="_a_d_p_u2_8h.html#aabf65945b9456ff645f794b8a751e915">ADPU2_SetInDataBuffer()</a> to set and release the memory buffer used by the DPU to manage the input data</li>
<li><a class="el" href="_a_d_p_u2_8h.html#ace516ae444be20060c9c611e45cb5003">ADPU2_SetOutDataBuffer()</a> to set and release the memory buffer used by the DPU to manage the output data</li>
</ul>
<h2><a class="anchor" id="dpu2_example"></a>
Example code</h2>
<p>Using a DPU is, normally, a three steps process:</p><ul>
<li><b>step 1</b>: allocate and initialize the DPU. After the allocation the DPU must be initialized. This is mandatory before using all others DPU APIs.</li>
<li><b>step 2</b>: allocate the buffers used by the DPU.</li>
<li><b>step 3</b>: connecting the DPU with a data source using a proper data builder.</li>
</ul>
<p>Let's see how to use one of the DPU provided with the component by analyzing a simple example. Imagine we want to use the <a class="el" href="_neai_d_p_u_8h.html#a02882cffc200b71b09f9844985d61f9e">NeaiDPU_t</a> to process the data coming from a sensor.</p>
<div class="fragment"><div class="line"><span class="comment">/*Step 1: allocate and initialize the DPU for the learning phase.*/</span></div>
<div class="line"><span class="comment">/*this is the DPU we use to integrate NanoEdge Library.*/</span></div>
<div class="line"><span class="keyword">static</span> <a class="code hl_struct" href="struct___neai_d_p_u__t.html">NeaiDPU_t</a> sDPU;</div>
<div class="line"><a class="code hl_struct" href="struct___a_d_p_u2.html">ADPU2_t</a> *p_dpu = (<a class="code hl_struct" href="struct___a_d_p_u2.html">ADPU2_t</a>*) <a class="code hl_function" href="_neai_d_p_u_8h.html#a56cb0b508e5c30fa03a673c4ef3de41d">NeaiDPU_StaticAlloc</a>(&amp;sDPU);</div>
<div class="line">(void) <a class="code hl_function" href="_neai_d_p_u_8h.html#a98f81591ee28e9673236f3966af269d6">NeaiDPU_Init</a>(&amp;sDPU, E_NEAI_ANOMALY_LEARN);</div>
<div class="line">(void)<a class="code hl_function" href="_a_d_p_u2_8h.html#a06be8e6a2f051fab19f30491284cf376">ADPU2_SetTag</a>(p_dpu, 0x7);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*Step 2: allocate the input data buffer for the DPU. The memory allocation is delegated to the application. */</span></div>
<div class="line"><span class="comment">/* how many signal I want to handle in parallel?</span></div>
<div class="line"><span class="comment"> * If the ODR is not too high or the inference time is not too long, then a buffer for two signals should be enough:</span></div>
<div class="line"><span class="comment"> * - 1 buffer to acquire a data in the sensor task</span></div>
<div class="line"><span class="comment"> * - 1 buffer to process a data in the process task</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">const</span> uint8_t max_signals_in_buffer = 2;</div>
<div class="line"><span class="keywordtype">size_t</span> buff_size = <a class="code hl_function" href="_a_d_p_u2_8h.html#a1e0b85b193b7334cc6e55a69d708a8fc">ADPU2_GetInDataPayloadSize</a>(p_dpu) * max_signals_in_buffer;</div>
<div class="line"><span class="comment">/*allocate the input buffer in the framework heap*/</span></div>
<div class="line">uint8_t *p_buff = <a class="code hl_function" href="sysmem_8h.html#a0faee92eed074177bc70c181cb926c70">SysAlloc</a>(buff_size);</div>
<div class="line"><a class="code hl_define" href="_b-_u585_i-_i_o_t02_a_2_applications_2_d_a_t_a_l_o_g2_2_core_2_inc_2stm32u5xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21">assert_param</a>(p_buff != NULL);</div>
<div class="line">res = <a class="code hl_function" href="_a_d_p_u2_8h.html#aabf65945b9456ff645f794b8a751e915">ADPU2_SetInDataBuffer</a>(p_dpu, p_buff, buff_size);</div>
<div class="line"><a class="code hl_define" href="_b-_u585_i-_i_o_t02_a_2_applications_2_d_a_t_a_l_o_g2_2_core_2_inc_2stm32u5xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21">assert_param</a>(!SYS_IS_ERROR_CODE(res));</div>
<div class="line"><span class="comment">/*allocate the output data buffer for the DPU: it must be big enough to store 1 output data.*/</span></div>
<div class="line">buff_size = <a class="code hl_function" href="_a_d_p_u2_8h.html#a2890fea42af3ed1c394414b606a856a7">ADPU2_GetOutDataPayloadSize</a>(p_dpu);</div>
<div class="line"><span class="comment">/*allocate the output buffer in the framework heap*/</span></div>
<div class="line">p_buff = <a class="code hl_function" href="sysmem_8h.html#a0faee92eed074177bc70c181cb926c70">SysAlloc</a>(buff_size);</div>
<div class="line"><a class="code hl_define" href="_b-_u585_i-_i_o_t02_a_2_applications_2_d_a_t_a_l_o_g2_2_core_2_inc_2stm32u5xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21">assert_param</a>(p_buff != NULL);</div>
<div class="line">res = <a class="code hl_function" href="_a_d_p_u2_8h.html#ace516ae444be20060c9c611e45cb5003">ADPU2_SetOutDataBuffer</a>(p_dpu, p_buff, buff_size);</div>
<div class="line"><a class="code hl_define" href="_b-_u585_i-_i_o_t02_a_2_applications_2_d_a_t_a_l_o_g2_2_core_2_inc_2stm32u5xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21">assert_param</a>(!SYS_IS_ERROR_CODE(res));</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*Step3: connect the DPU with the data source (sensor). */</span></div>
<div class="line"> *We need a data builder to convert the data from the sensor format (int16_t) to the input data wanted by the DPU (<span class="keywordtype">float</span>)</div>
<div class="line"> */</div>
<div class="line"><span class="comment">/*Get the ISourceObservable IF of the sensor*/</span></div>
<div class="line"><a class="code hl_struct" href="struct___i_source_observable.html">ISourceObservable</a> *p_data_src = SMGetSensorObserver(sensor_id);</div>
<div class="line"><span class="comment">/*allocate the data builder */</span></div>
<div class="line"><a class="code hl_struct" href="struct___i_data_builder.html">IDataBuilder_t</a> *p_data_builder = <a class="code hl_function" href="_int16to_float_data_builder_8h.html#a314750c83fae09b4dc03082267c68739">Int16ToFloatDB_Alloc</a>();</div>
<div class="line"><span class="keywordflow">if</span> (p_data_builder != NULL)</div>
<div class="line">{</div>
<div class="line">  res = <a class="code hl_function" href="_i_d_p_u2_8h.html#ad35d37b0e49d4eb7fbba0ac564c4be86">IDPU2_AttachToDataSource</a>((<a class="code hl_struct" href="struct___i_d_p_u2.html">IDPU2_t</a>*)p_dpu, p_data_source, p_data_builder, <a class="code hl_enumvalue" href="_i_data_builder_8h.html#acb8ba46f220f205e0053d110581ba59dacb93c0036aff87be6e18a9da1f021052">E_IDB_NO_DATA_LOSS</a>)</div>
<div class="line">  <a class="code hl_define" href="_b-_u585_i-_i_o_t02_a_2_applications_2_d_a_t_a_l_o_g2_2_core_2_inc_2stm32u5xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21">assert_param</a>(!SYS_IS_ERROR_CODE(res));</div>
<div class="line">}</div>
<div class="ttc" id="a_a_d_p_u2_8h_html_a06be8e6a2f051fab19f30491284cf376"><div class="ttname"><a href="_a_d_p_u2_8h.html#a06be8e6a2f051fab19f30491284cf376">ADPU2_SetTag</a></div><div class="ttdeci">sys_error_code_t ADPU2_SetTag(ADPU2_t *_this, uint32_t tag)</div><div class="ttdef"><b>Definition</b> <a href="_a_d_p_u2_8c_source.html#l00527">ADPU2.c:527</a></div></div>
<div class="ttc" id="a_a_d_p_u2_8h_html_a1e0b85b193b7334cc6e55a69d708a8fc"><div class="ttname"><a href="_a_d_p_u2_8h.html#a1e0b85b193b7334cc6e55a69d708a8fc">ADPU2_GetInDataPayloadSize</a></div><div class="ttdeci">static size_t ADPU2_GetInDataPayloadSize(ADPU2_t *_this)</div><div class="ttdef"><b>Definition</b> <a href="_a_d_p_u2_8h_source.html#l00414">ADPU2.h:414</a></div></div>
<div class="ttc" id="a_a_d_p_u2_8h_html_a2890fea42af3ed1c394414b606a856a7"><div class="ttname"><a href="_a_d_p_u2_8h.html#a2890fea42af3ed1c394414b606a856a7">ADPU2_GetOutDataPayloadSize</a></div><div class="ttdeci">static size_t ADPU2_GetOutDataPayloadSize(ADPU2_t *_this)</div><div class="ttdef"><b>Definition</b> <a href="_a_d_p_u2_8h_source.html#l00422">ADPU2.h:422</a></div></div>
<div class="ttc" id="a_a_d_p_u2_8h_html_aabf65945b9456ff645f794b8a751e915"><div class="ttname"><a href="_a_d_p_u2_8h.html#aabf65945b9456ff645f794b8a751e915">ADPU2_SetInDataBuffer</a></div><div class="ttdeci">sys_error_code_t ADPU2_SetInDataBuffer(ADPU2_t *_this, uint8_t *p_buffer, uint32_t buffer_size)</div><div class="ttdef"><b>Definition</b> <a href="_a_d_p_u2_8c_source.html#l00591">ADPU2.c:591</a></div></div>
<div class="ttc" id="a_a_d_p_u2_8h_html_ace516ae444be20060c9c611e45cb5003"><div class="ttname"><a href="_a_d_p_u2_8h.html#ace516ae444be20060c9c611e45cb5003">ADPU2_SetOutDataBuffer</a></div><div class="ttdeci">sys_error_code_t ADPU2_SetOutDataBuffer(ADPU2_t *_this, uint8_t *p_buffer, uint32_t buffer_size)</div><div class="ttdef"><b>Definition</b> <a href="_a_d_p_u2_8c_source.html#l00625">ADPU2.c:625</a></div></div>
<div class="ttc" id="a_b-_u585_i-_i_o_t02_a_2_applications_2_d_a_t_a_l_o_g2_2_core_2_inc_2stm32u5xx__hal__conf_8h_html_a631dea7b230e600555f979c62af1de21"><div class="ttname"><a href="_b-_u585_i-_i_o_t02_a_2_applications_2_d_a_t_a_l_o_g2_2_core_2_inc_2stm32u5xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21">assert_param</a></div><div class="ttdeci">#define assert_param(expr)</div><div class="ttdoc">Include module's header file.</div><div class="ttdef"><b>Definition</b> <a href="_b-_u585_i-_i_o_t02_a_2_applications_2_d_a_t_a_l_o_g2_2_core_2_inc_2stm32u5xx__hal__conf_8h_source.html#l00498">stm32u5xx_hal_conf.h:498</a></div></div>
<div class="ttc" id="a_i_d_p_u2_8h_html_ad35d37b0e49d4eb7fbba0ac564c4be86"><div class="ttname"><a href="_i_d_p_u2_8h.html#ad35d37b0e49d4eb7fbba0ac564c4be86">IDPU2_AttachToDataSource</a></div><div class="ttdeci">static sys_error_code_t IDPU2_AttachToDataSource(IDPU2_t *_this, ISourceObservable *p_data_source, IDataBuilder_t *p_builder, IDB_BuildStrategy_e build_strategy)</div></div>
<div class="ttc" id="a_i_data_builder_8h_html_acb8ba46f220f205e0053d110581ba59dacb93c0036aff87be6e18a9da1f021052"><div class="ttname"><a href="_i_data_builder_8h.html#acb8ba46f220f205e0053d110581ba59dacb93c0036aff87be6e18a9da1f021052">E_IDB_NO_DATA_LOSS</a></div><div class="ttdeci">@ E_IDB_NO_DATA_LOSS</div><div class="ttdef"><b>Definition</b> <a href="_i_data_builder_8h_source.html#l00047">IDataBuilder.h:47</a></div></div>
<div class="ttc" id="a_int16to_float_data_builder_8h_html_a314750c83fae09b4dc03082267c68739"><div class="ttname"><a href="_int16to_float_data_builder_8h.html#a314750c83fae09b4dc03082267c68739">Int16ToFloatDB_Alloc</a></div><div class="ttdeci">IDataBuilder_t * Int16ToFloatDB_Alloc(void)</div><div class="ttdef"><b>Definition</b> <a href="_int16to_float_data_builder_8c_source.html#l00157">Int16toFloatDataBuilder.c:157</a></div></div>
<div class="ttc" id="a_neai_d_p_u_8h_html_a56cb0b508e5c30fa03a673c4ef3de41d"><div class="ttname"><a href="_neai_d_p_u_8h.html#a56cb0b508e5c30fa03a673c4ef3de41d">NeaiDPU_StaticAlloc</a></div><div class="ttdeci">IDPU2_t * NeaiDPU_StaticAlloc(void *p_mem_block)</div><div class="ttdef"><b>Definition</b> <a href="_neai_d_p_u_8c_source.html#l00149">NeaiDPU.c:149</a></div></div>
<div class="ttc" id="a_neai_d_p_u_8h_html_a98f81591ee28e9673236f3966af269d6"><div class="ttname"><a href="_neai_d_p_u_8h.html#a98f81591ee28e9673236f3966af269d6">NeaiDPU_Init</a></div><div class="ttdeci">sys_error_code_t NeaiDPU_Init(NeaiDPU_t *_this, ENeaiMode_t mode)</div><div class="ttdef"><b>Definition</b> <a href="_neai_d_p_u_8c_source.html#l00255">NeaiDPU.c:255</a></div></div>
<div class="ttc" id="astruct___a_d_p_u2_html"><div class="ttname"><a href="struct___a_d_p_u2.html">_ADPU2</a></div><div class="ttdef"><b>Definition</b> <a href="_a_d_p_u2_8h_source.html#l00128">ADPU2.h:128</a></div></div>
<div class="ttc" id="astruct___i_d_p_u2_html"><div class="ttname"><a href="struct___i_d_p_u2.html">_IDPU2</a></div><div class="ttdef"><b>Definition</b> <a href="_i_d_p_u2__vtbl_8h_source.html#l00046">IDPU2_vtbl.h:46</a></div></div>
<div class="ttc" id="astruct___i_data_builder_html"><div class="ttname"><a href="struct___i_data_builder.html">_IDataBuilder</a></div><div class="ttdef"><b>Definition</b> <a href="_i_data_builder__vtbl_8h_source.html#l00050">IDataBuilder_vtbl.h:50</a></div></div>
<div class="ttc" id="astruct___i_source_observable_html"><div class="ttname"><a href="struct___i_source_observable.html">_ISourceObservable</a></div><div class="ttdef"><b>Definition</b> <a href="_i_source_observable__vtbl_8h_source.html#l00055">ISourceObservable_vtbl.h:56</a></div></div>
<div class="ttc" id="astruct___neai_d_p_u__t_html"><div class="ttname"><a href="struct___neai_d_p_u__t.html">_NeaiDPU_t</a></div><div class="ttdef"><b>Definition</b> <a href="_neai_d_p_u_8h_source.html#l00082">NeaiDPU.h:82</a></div></div>
<div class="ttc" id="asysmem_8h_html_a0faee92eed074177bc70c181cb926c70"><div class="ttname"><a href="sysmem_8h.html#a0faee92eed074177bc70c181cb926c70">SysAlloc</a></div><div class="ttdeci">void * SysAlloc(size_t nSize)</div><div class="ttdef"><b>Definition</b> <a href="sysinit_8c_source.html#l00358">sysinit.c:358</a></div></div>
</div><!-- fragment --><p>The DPU is now ready to process the data generated by the data source. If we want to observe the out_data generated by the DPU, we can use the method <a class="el" href="_a_d_p_u2_8h.html#aef69ce5da2a9bbc4dd8907f06741d1e6">ADPU2_GetEventSrcIF()</a> to get a pointer to the <a class="el" href="_i_event_8h.html#a69e6f9e97127c1da46bfc24fbfc36161">IEventSrc</a> interface of the DPU and register a listener of type <a class="el" href="_i_data_event_listener_8h.html#aecb1678824513757da49a8db8c0e6cb3">IDataEventListener_t</a>. When a new out_data is ready the DPU notifies all registered listeners using the virtual function IDataEventListenerOnNewDataReady().</p>
<h1><a class="anchor" id="dpu2_architecture"></a>
Architecture of a DPU</h1>
<p>The component provides an implementation of the <a class="el" href="_i_d_p_u2_8h.html#a28b7a8143eb954781059edc488fd8f54">IDPU2_t</a> interface, that is the <a href="https://computinglearner.com/abstract-class-in-object-oriented-programming/">abstract class</a> <a class="el" href="_a_d_p_u2_8h.html#a0cdc353f37b7d74e625ac7c8cb3675d8">ADPU2_t</a>. This abstract class implements all the virtual functions of the <a class="el" href="_i_d_p_u2_8h.html#a28b7a8143eb954781059edc488fd8f54">IDPU2_t</a> interface except the <a class="el" href="_i_d_p_u2_8h.html#a804dcc7225f3578daa26d618e42f2f9f">IDPU2_Process()</a> function. All the concrete DPU provided by the component inherit from <a class="el" href="_a_d_p_u2_8h.html#a0cdc353f37b7d74e625ac7c8cb3675d8">ADPU2_t</a> as displayed in <a class="el" href="dpu2_main.html#dpu2_fig6">Fig.6</a></p>
<p><a class="anchor" id="dpu2_fig6"></a></p><div class="image">
<img src="dpu2_class_hierarchy.png" alt=""/>
<div class="caption">
Fig.6 - DPU v2 class hierarchy</div></div>
<p>It manages most of the complexity of a DPU and its integration in the application framework, but it is still an abstract class. To have a concrete usable DPU a developer need to extend the <a class="el" href="_a_d_p_u2_8h.html#a0cdc353f37b7d74e625ac7c8cb3675d8">ADPU2_t</a> to provide:</p><ul>
<li>The <b>initialization</b> function</li>
<li>The virtual <b>processing</b> function, <a class="el" href="_i_d_p_u2_8h.html#a804dcc7225f3578daa26d618e42f2f9f">IDPU2_Process()</a></li>
</ul>
<p>The initialization function defines the in_data and out_data using <a class="el" href="em__data__format_8h.html#aad912ddf8bcbd156b91ced740cf047a9">EMData_t</a> format, and it must call the <a class="el" href="_a_d_p_u2_8h.html#ae4b43d018bfafd1b539f4265e1e39e17">ADPU2_Init()</a> to complete the object initialization. The processing function is called by the framework when a new in_data is ready and its specific of a concrete DPU. For an example look at <a class="el" href="_dummy___d_p_u2_8h.html#aff2771a0dbecb58f72e682b35fcd79f9">Dummy_DPU2_t</a>.</p>
<p>The architecture of the <a class="el" href="_a_d_p_u2_8h.html#a0cdc353f37b7d74e625ac7c8cb3675d8">ADPU2_t</a> is displayed in <a class="el" href="dpu2_main.html#dpu2_fig7">Fig.7</a>. It uses the event/listener design pattern to:</p><ul>
<li>Receive data from the attached data source (<a class="el" href="_a_d_p_u2_8h.html#a0cdc353f37b7d74e625ac7c8cb3675d8">ADPU2_t</a> implements <a class="el" href="_i_data_event_listener_8h.html#aecb1678824513757da49a8db8c0e6cb3">IDataEventListener_t</a>)</li>
<li>To notify all registered lister objects when a new out_data is ready (<a class="el" href="_a_d_p_u2_8h.html#a0cdc353f37b7d74e625ac7c8cb3675d8">ADPU2_t</a> implements <a class="el" href="_data_event_src_8h.html#aa2ea55a12d87bcde10b5e5c4cd8c67ee">DataEventSrc_t</a>)</li>
</ul>
<p>To manage the <b>input data buffer</b> (see <a class="el" href="dpu2_main.html#dpu2_fig5">Fig.5</a>) it uses a <a class="el" href="_circular_buffer_8h.html#a4c472af5f135ad315c076ca67370c5c0">CircularBuffer</a> - <a class="el" href="struct___a_d_p_u2.html#a71f6837a72fb4449672ce42f054fc30c">ADPU2_t::cbh</a>. All the signals are stored in the circular buffer and processed in a first in first out order. Note that the circular buffer is transparent to a developer (it is not exposed by the by the public API of <a class="el" href="_a_d_p_u2_8h.html#a0cdc353f37b7d74e625ac7c8cb3675d8">ADPU2_t</a>).</p>
<p>Other useful API function exported by the abstract class are <a class="el" href="_a_d_p_u2_8h.html#a06be8e6a2f051fab19f30491284cf376">ADPU2_SetTag()</a> and <a class="el" href="_a_d_p_u2_8h.html#a04f46e4b34f51267aa79a8723a08d1d8">ADPU2_GetTag()</a>. A tag is an application specific 32-bit value stored in the DPU.</p>
<p><a class="anchor" id="dpu2_fig7"></a></p><div class="image">
<img src="dpu2_class_diagram.png" alt="" width="900px"/>
<div class="caption">
Fig.7 - DPU v2 class diagram</div></div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Oct 10 2023 14:34:53 for FP-SNS-DATALOG2 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>

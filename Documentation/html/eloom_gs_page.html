<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FP-SNS-DATALOG2: Getting Started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FP-SNS-DATALOG2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="e_loo_m_main.html">eLooM framework</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Getting Started </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#eloom_gs_intro">Introduction</a><ul><li class="level2"><a href="#eloom_gs_folder_organization">Folder organization</a></li>
</ul>
</li>
<li class="level1"><a href="#eloom_gs_mandatory_files">Application mandatory files</a></li>
<li class="level1"><a href="#eloom_gs_app_file">The App.c file</a><ul><li class="level2"><a href="#eloom_gs_appfile_other">Other optional stuff for the App.c file</a></li>
</ul>
</li>
<li class="level1"><a href="#eloom_gs_first_task">How to implement the first Managed Task</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="eloom_gs_intro"></a>
Introduction</h1>
<p>This section aims to be a step by step guide to explain how to build an application using the eLooM framework. As example we will reuse the <a class="el" href="eloom_da_page.html">simple demo application</a> delivered with the framework.</p>
<h2><a class="anchor" id="eloom_gs_folder_organization"></a>
Folder organization</h2>
<p>Let's start giving a look at the folder organization of the framework and how it is integrated in a typical STM32 application. <a class="el" href="eloom_gs_page.html#eloom_gs_fig19">Fig.19</a> display on the left the eLooM folder structure and on the right an example of a complete STM32 application.</p>
<p><a class="anchor" id="eloom_gs_fig19"></a></p><div class="image">
<img src="19_packaging_diagram.png" alt=""/>
<div class="caption">
Fig.19 - Folder organization</div></div>
<p>The folder organization respects the application design, that is a soft real time and event driven system designed in multiple layers. So, if we think to a managed task as a tip of a subsystem that uses services and drivers, then <a class="el" href="eloom_gs_page.html#eloom_gs_fig24">Fig.24</a> is easy to understand, and it displays the relationship between the system layer.</p>
<p><a class="anchor" id="eloom_gs_fig24"></a></p><div class="image">
<img src="24_packaging_diagram_2.png" alt=""/>
<div class="caption">
Fig.24 - layers of the system</div></div>
<p>The map between folders and layer is displayed in the following table:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Layer </th><th class="markdownTableHeadLeft">Folders  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">App </td><td class="markdownTableBodyLeft">Application/Inc, Application/Src  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">3 </td><td class="markdownTableBodyLeft">eLooM/xxx/services, Application/xxx/services  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">2 </td><td class="markdownTableBodyLeft">eLooM/xxx/drivers, Application/xxx/drivers  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">1 </td><td class="markdownTableBodyLeft">Application/Drivers/cmsis, Application/Middlewares/freertos, Application/Drivers/stm32-hal  </td></tr>
</table>
<p>The application can provides services and low level drives to extend the framework.</p>
<p>On the side side of the layers (see <a class="el" href="e_loo_m_main.html#eloom_fig01">Fig.1</a>) there are few common components used across all system layers (<b>Event</b> and <b>Error</b>). These export some interfaces and implement common design patterns in order to decouple the application code from the algorithms implemented in the framework.</p>
<h1><a class="anchor" id="eloom_gs_mandatory_files"></a>
Application mandatory files</h1>
<p>The application must provide few files expected by the framework. It is also possible to modify and reuse the ones provided with the simple demo. Basically these are configuration header files. The following list gives a short description of these files. For more details look at the file documentation:</p>
<ul>
<li>Application/Inc/apperror.h - application specific error code.</li>
<li>Application/Inc/sysconfig.h - global system preferences file.</li>
<li>Application/Inc/sysdebug_config.h - configuration file for the debug resources.</li>
<li>Depending on the RTOS:<ul>
<li>Application/Inc/FreeRTOSConfig.h - FreeRTOS configuration file. For more information see <a href="https://freertos.org/a00110.html">this web page</a>.</li>
<li>Application/Inc/tx_user.h - ThreadX configuration file. For more information see <a href="https://learn.microsoft.com/en-us/azure/rtos/threadx/chapter2#configuration-options">this web page</a>.</li>
</ul>
</li>
<li>Application/Inc/stm32_assert.h - file generated by CubeMX.</li>
<li>Application/Inc/stm32xxxx_hal_conf.h - STM32 HAL configuration file for the specific MCU. It is generated by CubeMX.</li>
<li>Application/Src/App.c - define the application. This file defines the main entry points:<ul>
<li><a class="el" href="sysinit_8h.html#ae4794131d796c57eeb711511870325b4">SysLoadApplicationContext()</a>. Mandatory.</li>
<li><a class="el" href="sysinit_8h.html#aa78cf2180b6deac337e5b038455a66d4">SysOnStartApplication()</a>. Mandatory.</li>
<li><a class="el" href="sysinit_8h.html#aeb867760f6822701a13f42db516e88d8">SysGetErrorDelegate()</a>. Optional.</li>
<li><a class="el" href="sysinit_8h.html#a8ff2e6d7d60241839935aeb38d797a28">SysGetPowerModeHelper()</a>. Optional.</li>
</ul>
</li>
<li>Application/Src/stm32_assert.c - file generated by CubeMX.</li>
<li>Application/Src/stm32xxxx_hal_timebase_TIM.c - HAL tick definition. File generated by CubeMX.</li>
<li>Application/Src/stm32xxxx_it.c - global interrupt service routine definition file. It is generated by CubeMX.</li>
<li>mx/Src/sysinit_mx.c - adeveloper must define here the <a class="el" href="sysinit_8c.html#a70af21c671abfcc773614a9a4f63d920" title="System Clock Configuration.">SystemClock_Config()</a>, <a class="el" href="sysinit_8c.html#a1f7982c3a6d9ac68ca031c7449b6fd51" title="Power Configuration.">SystemPower_Config()</a>, the <a class="el" href="_b-_u585_i-_i_o_t02_a_2_applications_2_d_a_t_a_l_o_g2_2_core_2_src_2stm32u5xx__hal__msp_8c.html#ae4fb8e66865c87d0ebab74a726a6891f">HAL_MspInit()</a> and other functions generated by CubeMX.</li>
<li>mx/Inc and mx/Src - contain the HAL driver generated by CubeMX.</li>
</ul>
<p>The CubeMX project used for the simple demo can be downloaded from this <a href="NUCLEO-L452RE.ioc" target="_blank"><b>link</b></a>.</p>
<h1><a class="anchor" id="eloom_gs_app_file"></a>
The App.c file</h1>
<p>In an eLooM based application the <a class="el" href="_b-_u585_i-_i_o_t02_a_2_applications_2_d_a_t_a_l_o_g2_2_core_2_src_2main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main()</a> function and main.c file are provided by the framework and they are not intended to be modified by the developer. The developer needs another file where to define the application entry points in order to integrate the application code with the framework. In the simple demo this is done in the <b>App.c</b> file. In this file are defined two functions.</p>
<p>The first one, <a class="el" href="sysinit_8h.html#ae4794131d796c57eeb711511870325b4">SysLoadApplicationContext()</a>, is called by the INIT task after the basic hardware resources (except the ones used by the managed tasks) have been initialized, as well as the AED <a href="#footnote-2">[2]</a> and APMH <a href="#footnote-3">[3]</a> objects have been allocated and initialized. We use this function to instantiate the managed tasks, and to add them to the <a class="el" href="_application_context_8h.html#a7592228ea4590b51b4fce8ecc5a66b93">ApplicationContext</a> object passed as a parameter. To add a managed task to the <a class="el" href="_application_context_8h.html#a7592228ea4590b51b4fce8ecc5a66b93">ApplicationContext</a> we use the <a class="el" href="_application_context_8h.html#a1b56c74bfbf66806ee37743fad3a03eb">ACAddTask()</a> function. In this way the INIT task is aware of all the application managed tasks.</p>
<p>The second function redefined in the App.c file is the <a class="el" href="sysinit_8h.html#aa78cf2180b6deac337e5b038455a66d4">SysOnStartApplication()</a>. This function is used to connect the managed tasks. In the sample demo case, both managed tasks use the same driver object of type NucleoDriver. This function is called by the INIT task after all managed task have been initialized, so it is safe to assume that the driver has been allocated. Note that to share the driver it is used a pointer to the the base interface <a class="el" href="_i_driver_8h.html#af510b3df23076a172ebd286865cc28e9">IDriver</a>, but we know that actual type of that object is NucleoDriver.</p>
<h2><a class="anchor" id="eloom_gs_appfile_other"></a>
Other optional stuff for the App.c file</h2>
<p>If you remember <a class="el" href="e_loo_m_main.html#eloom_fig21">Fig.21</a> the INIT task works with two other objects in order to implement the features of a real application. The simple demo does not use any error management strategy, so it does not need to implement the <a class="el" href="_i_application_error_delegate_8h.html#a105ef6c94544adf17ae430dd98a75312">IApplicationErrorDelegate</a> interface. For this reason the demo uses the default <a class="el" href="_null_error_delegate_8h.html#ab4d8826fe26a32689eecaa8e85afb9b2">NullErrorDelegate</a>. A more complex application, on the other side, has to deal with error. In this case the App.c file is a good place to redefine the <a class="el" href="sysinit_8h.html#aeb867760f6822701a13f42db516e88d8">SysGetErrorDelegate()</a> function in order to provide an application specific implementation of the AED.</p>
<p>In the same way, it is possible to redefine the <a class="el" href="sysinit_8h.html#a8ff2e6d7d60241839935aeb38d797a28">SysGetPowerModeHelper()</a> function and provide an application specific APMH object.</p>
<h1><a class="anchor" id="eloom_gs_first_task"></a>
How to implement the first Managed Task</h1>
<p>The simple demo implements two Managed tasks in order to blink the LED and detect the push button events. At the beginning of the App.c file we can see how the task are declared and added to the <a class="el" href="_application_context_8h.html#a7592228ea4590b51b4fce8ecc5a66b93">ApplicationContext</a>: </p><pre class="fragment"> // Application managed task.
 static AManagedTask *s_pxHelloWorldObj = NULL;

 // Application managed task.
 static AManagedTaskEx *s_pxPushButtonObj = NULL;


 sys_error_code_t SysLoadApplicationContext(ApplicationContext *pAppContext) {
   assert_param(pAppContext);
   sys_error_code_t xRes = SYS_NO_ERROR_CODE;


   // Allocate the task objects
   s_pxHelloWorldObj = HelloWorldTaskAlloc();
   s_pxPushButtonObj = PushButtonTaskAlloc();

   // Add the task object to the context.
   xRes = ACAddTask(pAppContext, s_pxHelloWorldObj);
   xRes = ACAddTask(pAppContext, (AManagedTask*)s_pxPushButtonObj);

   return xRes;
 }
</pre><p>Let's give a look to the HelloWorldTask to see how it is implemented. The framework takes some concept from the OO programming <a href="#footnote-4">[4]</a>. In particular it is widely used the <a href="https://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)"><em>inheritance</em></a> implemented with the composition of the data structure and the <a href="https://stackoverflow.com/questions/1031273/what-is-polymorphism-what-is-it-for-and-how-is-it-used#1031385"><em>polymorphism</em></a> implemented with the virtual table.</p>
<p>To implement a Managed task we need three files:</p><ul>
<li>HelloWorldTask.h: the normal header file</li>
<li>HelloWorldTask_vtbl.h: this header declares the redefined functions of the virtual table of the object class.</li>
<li>HelloWorldTask.c: the source code.</li>
</ul>
<p>It is possible to use the eLooM template to generate the skeleton for these files.</p>
<p><a class="anchor" id="eloom_gs_fig25"></a></p><div class="image">
<img src="25_template_1.png" alt=""/>
<div class="caption">
Fig.25 - eLooM template</div></div>
<p>TO BE CONTINUED ...</p>
<hr  />
 <p>[1] xxx stands for <code>src</code> or <code>include</code>.</p>
<p>[2] AED is the Application Error Delegate. For more information see the section <a class="el" href="e_loo_m_main.html#eloom_error_advanced">Advanced support</a>.</p>
<p>[3] APMH is the Application Power Mode Helper. For more information see the section <a class="el" href="e_loo_m_main.html#eloom_power_management">Power Management</a>.</p>
<p>[4] OO stands for <a href="https://en.wikipedia.org/wiki/Object-oriented_programming">Object-oriented programming</a>.</p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 3 2023 17:27:33 for FP-SNS-DATALOG2 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FP-SNS-DATALOG2: A Simple Demo</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FP-SNS-DATALOG2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="e_loo_m_main.html">eLooM framework</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">A Simple Demo </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#eloom_app_intro">Introduction</a></li>
<li class="level1"><a href="#eloom_app_app_tasks">Application Tasks</a><ul><li class="level2"><a href="#eloom_app_HelloWorldTask">Hello World Task</a><ul><li class="level3"><a href="#eloom_app_HelloWorldTask_LL">Low Level Driver</a></li>
<li class="level3"><a href="#eloom_app_HelloWorldTask_SL">Service Layer</a></li>
<li class="level3"><a href="#eloom_app_HelloWorldTask_AL">Application Layer</a></li>
</ul>
</li>
<li class="level2"><a href="#eloom_app_PushButtonTask">Push Button Task</a><ul><li class="level3"><a href="#eloom_app_PushButtonTask_LL">Low Level Driver</a></li>
<li class="level3"><a href="#eloom_app_PushButtonTask_SL">Service Layer</a></li>
<li class="level3"><a href="#eloom_app_PushButtonTask_AL">Application Layer&#39;</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#eloom_app_build_configs">Build Configurations</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="eloom_app_intro"></a>
Introduction</h1>
<p>This section gives a look to the simple demo application delivered with the framework. It has been developed on a <a href="https://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/mcu-eval-tools/stm32-mcu-eval-tools/stm32-mcu-nucleo/nucleo-l452re.html">NUCLEO-L452RE</a> board. Despite its simplicity it is a good example to understand how to implement an application with the <a class="el" href="e_loo_m_main.html#eloom_overview">eLooM framework</a>.</p>
<p>The application implements two managed tasks, one to blink the LED with a regular interval (::HelloWorldTask), and another to put the system in low power mode and wake-up it when the user press the push button (PushButtonTask). The demo uses also a driver to operate the GPIO IP (NucleoDriver).</p>
<p><a class="el" href="eloom_da_page.html#eloom_app_fig22">Fig.22</a> displays how the demo application extends the firmware architecture of the framework. The new objects are highlighted in yellow.</p>
<p><a class="anchor" id="eloom_app_fig22"></a></p><div class="image">
<img src="22_demo_architecture.png" alt="" width="900px"/>
<div class="caption">
Fig.22 - Demo firmware architecture</div></div>
<p>When the user power on the Nucleo board, the user LED start blinking with a period of 1 second and a duty cycle of 50%. The first time the user press the push button the system is armed. This means that from now on every successive press of the push button will trigger a transaction from RUN to SLEEP_1 or vice versa. When the system is in SLEEP_1 the LED stops blinking. When the system is in RUN the LED starts blinking again. By default in SLEEP_1 the APMH put the MCU in STOP2, but the user can change the low power mode to STANDBY by modifying the SYS_CFG_DEF_PM_HELPER_STANDBY parameters in the sysconfig.h file.</p>
<h1><a class="anchor" id="eloom_app_app_tasks"></a>
Application Tasks</h1>
<p>This section gives a look to the features exported by the application managed tasks. There are two application tasks plus one system task and two FreeRTOS daemon tasks.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Index </th><th class="markdownTableHeadLeft">Task name </th><th class="markdownTableHeadRight">Task priority </th><th class="markdownTableHeadLeft">Note  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">1 </td><td class="markdownTableBodyLeft">HelloWorld task </td><td class="markdownTableBodyRight">tskIDLE_PRIORITY+1 = 1 </td><td class="markdownTableBodyLeft">Managed task  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">2 </td><td class="markdownTableBodyLeft">PushButton task </td><td class="markdownTableBodyRight">tskIDLE_PRIORITY+2 = 2 </td><td class="markdownTableBodyLeft">Managed task Ex  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"></td><td class="markdownTableBodyLeft"></td><td class="markdownTableBodyRight"></td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">3 </td><td class="markdownTableBodyLeft">INIT task </td><td class="markdownTableBodyRight">configMAX_PRIORITIES - 1 = 4 </td><td class="markdownTableBodyLeft">system task  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">4 </td><td class="markdownTableBodyLeft">Idle task </td><td class="markdownTableBodyRight">tskIDLE_PRIORITY = 0 </td><td class="markdownTableBodyLeft">FreeRTOS task  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">5 </td><td class="markdownTableBodyLeft">Timer service task </td><td class="markdownTableBodyRight">configTIMER_TASK_PRIORITY= 3 </td><td class="markdownTableBodyLeft">FreeRTOS task  </td></tr>
</table>
<p>The scheduler executes the ready task with highest priority. The system is configured with 5 priority levels, from the lowest (0) to the highest (4). The highest priority level (4) is not used by the managed tasks, because it is reserved to a special system task, the INIT task. Each task is designed to respond to events generated by the MCU peripherals IRQ or by software events, for example messages.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Index </th><th class="markdownTableHeadLeft">IRQ line </th><th class="markdownTableHeadCenter">IRQ priority </th><th class="markdownTableHeadLeft">Note  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">1 </td><td class="markdownTableBodyLeft">EXTI15_10_IRQn </td><td class="markdownTableBodyCenter">13 </td><td class="markdownTableBodyLeft">EXTI 13 used to detect the push button events  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"></td><td class="markdownTableBodyLeft"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyLeft"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">2 </td><td class="markdownTableBodyLeft">TIM6_IRQn </td><td class="markdownTableBodyCenter">14 </td><td class="markdownTableBodyLeft">High frequency tick to generate the runtime statistics in DEBUG  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">3 </td><td class="markdownTableBodyLeft">TIM3_IRQn </td><td class="markdownTableBodyCenter">15 </td><td class="markdownTableBodyLeft">generates the HAL 1ms tick  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">4 </td><td class="markdownTableBodyLeft">SysTick_IRQn </td><td class="markdownTableBodyCenter">15 </td><td class="markdownTableBodyLeft">generate the scheduler 1ms tick  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">5 </td><td class="markdownTableBodyLeft">PendSV_IRQn </td><td class="markdownTableBodyCenter">15 </td><td class="markdownTableBodyLeft">Used by FreeTOS  </td></tr>
</table>
<p>Note that, despite the task priorities, the Cortex-M defines the IRQ priorities from the lowest 15 to the highest 0.</p>
<h2><a class="anchor" id="eloom_app_HelloWorldTask"></a>
Hello World Task</h2>
<p>This managed task is responsible to blink the user LED with a fixed period of 1 second and a duty cycle of 50%.</p>
<h3><a class="anchor" id="eloom_app_HelloWorldTask_LL"></a>
Low Level Driver</h3>
<p>In the Low Level API layer this demo introduce one driver object, the NucleoDriver. This driver allow the application tasks to operate the hardware (push button and LED). Only one driver is implemented for this demo and it is shared between the managed tasks.</p>
<h3><a class="anchor" id="eloom_app_HelloWorldTask_SL"></a>
Service Layer</h3>
<p>This demo, due to its simplicity, does not provide any service in this layer.</p>
<h3><a class="anchor" id="eloom_app_HelloWorldTask_AL"></a>
Application Layer</h3>
<p>The HelloWorldTask extends the <a class="el" href="_a_managed_task_8h.html#af516b211ac6895cd8b909223b7f8d743">AManagedTask</a> interface. This is because the task feature is well modeled by this base class a control loop that implements a short step in order to keep the system responsive.</p>
<p>This managed task allocate the driver (NucleoDriver) in the <a class="el" href="_b-_u585_i-_i_o_t02_a_2_applications_2_d_a_t_a_l_o_g2_2_core_2_inc_2_hello_world_task__vtbl_8h.html#a60136e510d6607f3aaf6c1fc5be4a74f">HelloWorldTask_vtblHardwareInit()</a> virtual function and it exports the API to share the driver object with the other managed tasks - HelloWorldTaskGetDriver().</p>
<h2><a class="anchor" id="eloom_app_PushButtonTask"></a>
Push Button Task</h2>
<p>This managed task is responsible to handle the user button and to generate the <a class="el" href="sysevent_8h.html#a39607b2b3e92a9bf584ee36bae1e2182">SysEvent</a> in order to trigger the power mode transactions.</p>
<h3><a class="anchor" id="eloom_app_PushButtonTask_LL"></a>
Low Level Driver</h3>
<p>This managed task uses the driver allocated by the HelloWorldTask. The link between the driver and the task is done in the <a class="el" href="sysinit_8h.html#aa78cf2180b6deac337e5b038455a66d4">SysOnStartApplication()</a> function, to be sure that all the resources of the demo application have been allocated and initialized.</p>
<h3><a class="anchor" id="eloom_app_PushButtonTask_SL"></a>
Service Layer</h3>
<p>This demo, due to its simplicity, does not provide any service in this layer.</p>
<h3><a class="anchor" id="eloom_app_PushButtonTask_AL"></a>
Application Layer'</h3>
<p>The PushButtonTask extends the <a class="el" href="_a_managed_task_ex_8h.html#ad87736e39ee8628f90cabba1d7747236">AManagedTaskEx</a> interface. This interface, that in turn extends the <a class="el" href="_a_managed_task_8h.html#af516b211ac6895cd8b909223b7f8d743">AManagedTask</a>, allows a managed task to block its execution for an indefinite period of time (portMAX_DELAY). This exactly matches the semantic of the task, that has to wait for the button pressed and the button released events.</p>
<h1><a class="anchor" id="eloom_app_build_configs"></a>
Build Configurations</h1>
<p>There are four build configurations for the demo than can be selected from the <em>Manage Configuration</em> dialog of Atollic TrueSTUDIO</p>
<p><a class="anchor" id="eloom_app_fig23"></a></p><div class="image">
<img src="23_demo_build_configs.png" alt=""/>
<div class="caption">
Fig.23 - Builds Configuration</div></div>
<ul>
<li><b>Debug</b>: this configuration enables the Debug log via UART. For more information see the SYS_DEBUGF3() and <a class="el" href="sysdebug_8h.html#a53d3f0305cd3cbd1392e02808d6bbb2c">SysDebugInit()</a> functions. It also allow to debug the application in low power mode.</li>
<li><b>Release</b>: this configuration optimize the final binary file by using the -O2 option and by removing the debug features.</li>
<li><b>TEST_R</b>: this configuration is like the Release but keep enabled the Debug log.</li>
<li><b>Trace</b>: this configuration enable the <a href="https://percepio.com/tracealyzer/">Tracealyzer 4</a> support. The trace is configured in streaming mode, so the user has to start a streaming trace after lunching this debug configuration. To use TA4 in streaming mode a J-Link probe is needed. It is possible to convert the embedded ST-Link of the NUCLEO board to emulate the J-Link. For more information look at this <a href="https://www.segger.com/products/debug-probes/j-link/models/other-j-links/st-link-on-board/">web page</a>. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 3 2023 17:27:33 for FP-SNS-DATALOG2 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
